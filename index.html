<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>OBY Energy Admin - Parte 2</title>
</head>
<body>
    <script type="text/babel">
        // CONTINUA√á√ÉO DO C√ìDIGO DA PARTE 1

        // --- COMPONENTE DO MODAL DE EDI√á√ÉO ---
        function EditPropostaModal({ proposta, onClose, onSave, saving }) {
            
            const editableColumns = [
                'nome', 'sobrenome', 'nome_fantasia', 'email', 'telefone', 'cep', 'cidade', 'estado', 
                'cpf', 'cnpj', 'logradouro', 'numero_endereco', 'complemento', 'consumo_kwh', 
                'distribuidora_energia', 'status', 'tipo_pessoa', 'numero_instalacao', 
                'tipo_conexao', 'vendedor' 
            ];

            const [formData, setFormData] = useState({
                ...proposta,
                nome: proposta.nome || '',
                sobrenome: proposta.sobrenome || '',
                cpf: proposta.cpf || '',
                cnpj: proposta.cnpj || '',
                logradouro: proposta.logradouro || '',
                numero_endereco: proposta.numero_endereco || '',
                complemento: proposta.complemento || '',
                consumo_kwh: proposta.consumo_kwh || 0,
                distribuidora_energia: proposta.distribuidora_energia || '',
                vendedor: proposta.vendedor || ''
            });

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSave = () => {
                const dataToSave = { id: formData.id };
                
                if (!formData.numero_contrato || formData.numero_contrato === '-') {
                    const anoAtual = new Date().getFullYear();
                    const idCurto = String(formData.id).slice(-5);
                    dataToSave.numero_contrato = `OBY-${anoAtual}-${idCurto}`;
                }
                
                editableColumns.forEach(column => {
                    if (formData.hasOwnProperty(column)) {
                        let value = formData[column];
                        if (column === 'consumo_kwh') {
                            value = Number(value);
                        }
                        dataToSave[column] = value;
                    }
                });
                
                onSave(dataToSave);
            };

            const inputClass = "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150";
            const labelClass = "block text-sm font-medium text-gray-700 mb-1";

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
                        <div className="p-6 border-b border-gray-200">
                            <h2 className="text-2xl font-bold text-gray-800">üìù Editar Proposta: {proposta.numero_contrato || 'N/A'}</h2>
                            <p className="text-sm text-gray-500">Altere os dados da proposta do cliente. O N√∫mero do Contrato n√£o pode ser editado.</p>
                        </div>

                        <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto">
                            {/* Informa√ß√µes do Contrato */}
                            <div className="md:col-span-2 bg-gray-100 p-4 rounded-lg border-l-4 border-gray-400">
                                <h3 className="font-bold text-lg mb-3 text-gray-700">Detalhes de Identifica√ß√£o</h3>
                                <div className="space-y-3">
                                    <div>
                                        <label className={labelClass}>N√∫mero do Contrato</label>
                                        <input type="text" value={proposta.numero_contrato || 'N/A'} disabled className={`${inputClass} bg-gray-200 cursor-not-allowed text-gray-700 font-semibold`} />
                                    </div>
                                </div>
                            </div>

                            {/* Dados Pessoais */}
                            <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400">
                                <h3 className="font-bold text-lg mb-4 text-blue-800">Dados Pessoais</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className={labelClass}>Nome</label>
                                        <input type="text" name="nome" value={formData.nome} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                                        <label className={labelClass}>Sobrenome</label>
                                        <input type="text" name="sobrenome" value={formData.sobrenome} onChange={handleChange} className={inputClass} />
                                    </div>
                                    {formData.tipo_pessoa === 'juridica' && (
                                        <div>
                                            <label className={labelClass}>Nome Fantasia</label>
                                            <input type="text" name="nome_fantasia" value={formData.nome_fantasia || ''} onChange={handleChange} className={inputClass} />
                                        </div>
                                    )}
                                    <div>
                                        <label className={labelClass}>Email</label>
                                        <input type="email" name="email" value={formData.email || ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                                        <label className={labelClass}>Telefone</label>
                                        <input type="text" name="telefone" value={formData.telefone || ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                                        <label className={labelClass}>{formData.tipo_pessoa === 'fisica' ? 'CPF' : 'CNPJ'}</label>
                                        <input 
                                            type="text" 
                                            name={formData.tipo_pessoa === 'fisica' ? 'cpf' : 'cnpj'} 
                                            value={formData.tipo_pessoa === 'fisica' ? formData.cpf || '' : formData.cnpj || ''} 
                                            onChange={handleChange} 
                                            className={inputClass} 
                                        />
                                    </div>
                                    <div>
                                        <label className={labelClass}>Vendedor</label>
                                        <input type="text" name="vendedor" value={formData.vendedor || ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                                        <label className={labelClass}>Status da Proposta</label>
                                        <select name="status" value={formData.status || 'pendente'} onChange={handleChange} className={inputClass}>
                                            <option value="pendente">üü° Pendente</option>
                                            <option value="aprovado">üü¢ Aprovado</option>
                                            <option value="reprovado">üî¥ Reprovado</option>
                                            <option value="lista_espera">üü† Lista de Espera</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            {/* Dados de Endere√ßo e Instala√ß√£o */}
                            <div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
                                <h3 className="font-bold text-lg mb-4 text-green-800">Endere√ßo e Instala√ß√£o</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className={labelClass}>CEP</label>
                                        <input type="text" name="cep" value={formData.cep || ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                                        <label className={labelClass}>Logradouro</label>
                                        <input type="text" name="logradouro" value={formData.logradouro || ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className={labelClass}>N√∫mero</label>
                                            <input type="text" name="numero_endereco" value={formData.numero_endereco || ''} onChange={handleChange} className={inputClass} />
                                        </div>
                                        <div>
                                            <label className={labelClass}>Complemento</label>
                                            <input type="text" name="complemento" value={formData.complemento || ''} onChange={handleChange} className={inputClass} />
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className={labelClass}>Cidade</label>
                                            <input type="text" name="cidade" value={formData.cidade || ''} onChange={handleChange} className={inputClass} />
                                        </div>
                                        <div>
                                            <label className={labelClass}>Estado (UF)</label>
                                            <input type="text" name="estado" value={formData.estado || ''} onChange={handleChange} className={inputClass} />
                                        </div>
                                    </div>
                                    <div>
                                        <label className={labelClass}>Distribuidora</label>
                                        <input type="text" name="distribuidora_energia" value={formData.distribuidora_energia || ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                                        <label className={labelClass}>Consumo M√©dio (kWh)</label>
                                        <input type="number" step="1" name="consumo_kwh" value={formData.consumo_kwh || 0} onChange={handleChange} className={inputClass} />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Bot√µes do Modal */}
                        <div className="p-6 flex justify-end gap-3 border-t border-gray-200">
                            <button onClick={onClose} className="px-6 py-3 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600">
                                Cancelar
                            </button>
                            <button onClick={handleSave} disabled={saving} className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50">
                                {saving ? 'Salvando...' : 'üíæ Salvar Altera√ß√µes'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // CONTINUA COM VENDEDORES E ADMIN PANEL...
        // (Copie o restante do c√≥digo original aqui, substituindo apenas a fun√ß√£o gerarContratoPDF)
    </script>
</body>
</html>