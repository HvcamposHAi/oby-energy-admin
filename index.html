const atualizarStatus = async (propostaId, novoStatus) => {
                try {
                    setPropostas(prev => prev.map(p => 
                        p.id === propostaId ? {...p, updating: true, showMenu: false} : {...p, showMenu: false}
                    ));
                    
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/propostas?id=eq.${propostaId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'apikey': SUPABASE_KEY,
                            // Garantindo que aceitamos JSON e forçamos o retorno completo
                            'Content-Type': 'application/json',
                            'Accept': 'application/json', // <== NOVO
                            'Prefer': 'return=representation' // <== MANTIDO E ESSENCIAL
                        },
                        body: JSON.stringify({
                            status: novoStatus 
                        })
                    });

                    if (response.ok) {
                        const responseText = await response.text();
                        
                        // CORREÇÃO: Verifica se o texto da resposta está vazio (quebra o JSON.parse)
                        let data;
                        if (responseText) {
                            try {
                                data = JSON.parse(responseText);
                            } catch (e) {
                                console.error('Falha ao processar JSON:', responseText, e);
                                throw new Error('Erro ao atualizar status: Resposta vazia ou JSON inválido.');
                            }
                        } else {
                             // Se o Supabase não retorna o JSON, buscamos o registro atualizado.
                            await carregarPropostas(); 
                            return;
                        }
                        
                        setPropostas(prev => prev.map(p => 
                            p.id === propostaId ? {...data[0], showMenu: false, updating: false} : p
                        ));
                    } else {
                        const errorText = await response.text();
                        throw new Error(errorText);
                    }
                } catch (error) {
                    console.error('❌ Erro ao atualizar status:', error);
                    alert('Erro ao atualizar status: ' + error.message);
                    setPropostas(prev => prev.map(p => 
                        p.id === propostaId ? {...p, updating: false} : p
                    ));
                }
            };
