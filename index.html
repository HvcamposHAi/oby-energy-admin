<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBY Energy - Painel Administrativo</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script> 
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configurações do Supabase
        const SUPABASE_URL = 'https://uuaqmwnfjopgjmjjchmw.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1YXFtd25mam9wZ2ptampjaG13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1OTEyNzUsImV4cCI6MjA3NjE2NzI3NX0.9ITSBR9SNoZKgvF1AuW4OsL4b8Du5NAXttQpi7B3MO8';

        // Credenciais de Admin
        const ADMIN_USER = 'admin';
        const ADMIN_PASS = 'oby2025';

        // --- COMPONENTE: GESTÃO DE VENDEDORES ---
        function VendedoresGestao() {
            const [vendedores, setVendedores] = useState([]);
            const [loading, setLoading] = useState(false);
            const [mostrarFormulario, setMostrarFormulario] = useState(false);
            const [vendedorSelecionado, setVendedorSelecionado] = useState(null);
            const [mostrarDetalhes, setMostrarDetalhes] = useState(false);
            const [filtroStatus, setFiltroStatus] = useState('todos');
            const [busca, setBusca] = useState('');
            
            const [formVendedor, setFormVendedor] = useState({
                nome_completo: '',
                cpf: '',
                email: '',
                telefone: '',
                celular: '',
                data_nascimento: '',
                cep: '',
                logradouro: '',
                numero: '',
                complemento: '',
                bairro: '',
                cidade: '',
                estado: '',
                banco: '',
                agencia: '',
                conta: '',
                tipo_conta: 'corrente',
                pix: '',
                rg: '',
                comissao_percentual: '5.00',
                meta_mensal: '0',
                codigo_vendedor: '',
                observacoes: '',
                status: 'ativo'
            });

            const [arquivos, setArquivos] = useState({
                rg_frente: null,
                rg_verso: null,
                comprovante_residencia: null
            });

            const [errors, setErrors] = useState({});

            useEffect(() => {
                carregarVendedores();
            }, []);

            const carregarVendedores = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/vendedores?select=*&order=data_cadastro.desc`, {
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'apikey': SUPABASE_KEY
                        }
                    });
                    const data = await response.json();
                    setVendedores(data || []);
                } catch (error) {
                    console.error('Erro ao carregar vendedores:', error);
                    alert('Erro ao carregar vendedores');
                } finally {
                    setLoading(false);
                }
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormVendedor(prev => ({ ...prev, [name]: value }));
                if (errors[name]) setErrors(prev => ({ ...prev, [name]: '' }));
            };

            const handleFileChange = (e) => {
                const { name, files } = e.target;
                if (files && files[0]) {
                    setArquivos(prev => ({ ...prev, [name]: files[0] }));
                }
            };

            const validarCPF = (cpf) => {
                cpf = cpf.replace(/[^\d]/g, '');
                if (cpf.length !== 11) return false;
                
                let soma = 0;
                let resto;
                
                if (cpf === "00000000000") return false;
                
                for (let i = 1; i <= 9; i++) 
                    soma += parseInt(cpf.substring(i-1, i)) * (11 - i);
                resto = (soma * 10) % 11;
                
                if ((resto === 10) || (resto === 11)) resto = 0;
                if (resto !== parseInt(cpf.substring(9, 10))) return false;
                
                soma = 0;
                for (let i = 1; i <= 10; i++) 
                    soma += parseInt(cpf.substring(i-1, i)) * (12 - i);
                resto = (soma * 10) % 11;
                
                if ((resto === 10) || (resto === 11)) resto = 0;
                if (resto !== parseInt(cpf.substring(10, 11))) return false;
                
                return true;
            };

            const validarFormulario = () => {
                const novosErros = {};

                if (!formVendedor.nome_completo.trim()) novosErros.nome_completo = 'Nome completo obrigatório';
                if (!formVendedor.cpf.trim()) {
                    novosErros.cpf = 'CPF obrigatório';
                } else if (!validarCPF(formVendedor.cpf)) {
                    novosErros.cpf = 'CPF inválido';
                }
                if (!formVendedor.email.trim()) {
                    novosErros.email = 'Email obrigatório';
                } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formVendedor.email)) {
                    novosErros.email = 'Email inválido';
                }
                if (!formVendedor.telefone.trim()) novosErros.telefone = 'Telefone obrigatório';
                if (!formVendedor.codigo_vendedor.trim()) novosErros.codigo_vendedor = 'Código do vendedor obrigatório';
                
                const comissao = parseFloat(formVendedor.comissao_percentual);
                if (isNaN(comissao) || comissao < 0 || comissao > 100) {
                    novosErros.comissao_percentual = 'Comissão deve estar entre 0 e 100';
                }

                setErrors(novosErros);
                return Object.keys(novosErros).length === 0;
            };

            const uploadArquivo = async (arquivo, pasta) => {
                if (!arquivo) return null;

                const nomeArquivo = `${pasta}/${Date.now()}_${arquivo.name}`;
                const formData = new FormData();
                formData.append('file', arquivo);

                try {
                    const response = await fetch(`${SUPABASE_URL}/storage/v1/object/documentos-vendedores/${nomeArquivo}`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'apikey': SUPABASE_KEY
                        },
                        body: arquivo
                    });

                    if (response.ok) {
                        return `${SUPABASE_URL}/storage/v1/object/public/documentos-vendedores/${nomeArquivo}`;
                    }
                    return null;
                } catch (error) {
                    console.error('Erro ao fazer upload:', error);
                    return null;
                }
            };

            const salvarVendedor = async () => {
                if (!validarFormulario()) {
                    alert('Por favor, corrija os erros no formulário');
                    return;
                }

                setLoading(true);

                try {
                    // Upload dos arquivos
                    const urlRgFrente = await uploadArquivo(arquivos.rg_frente, 'rg_frente');
                    const urlRgVerso = await uploadArquivo(arquivos.rg_verso, 'rg_verso');
                    const urlComprovante = await uploadArquivo(arquivos.comprovante_residencia, 'comprovantes');

                    const dadosVendedor = {
                        ...formVendedor,
                        cpf: formVendedor.cpf.replace(/[^\d]/g, ''),
                        comissao_percentual: parseFloat(formVendedor.comissao_percentual),
                        meta_mensal: parseInt(formVendedor.meta_mensal) || 0,
                        arquivo_rg_frente_url: urlRgFrente,
                        arquivo_rg_verso_url: urlRgVerso,
                        arquivo_comprovante_residencia_url: urlComprovante
                    };

                    let response;
                    if (vendedorSelecionado) {
                        // Atualização
                        response = await fetch(`${SUPABASE_URL}/rest/v1/vendedores?id=eq.${vendedorSelecionado.id}`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(dadosVendedor)
                        });
                    } else {
                        // Criação
                        response = await fetch(`${SUPABASE_URL}/rest/v1/vendedores`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(dadosVendedor)
                        });
                    }

                    if (response.ok) {
                        alert(vendedorSelecionado ? 'Vendedor atualizado com sucesso!' : 'Vendedor cadastrado com sucesso!');
                        setMostrarFormulario(false);
                        limparFormulario();
                        carregarVendedores();
                    } else {
                        const erro = await response.json();
                        alert('Erro ao salvar vendedor: ' + (erro.message || 'Erro desconhecido'));
                    }
                } catch (error) {
                    console.error('Erro ao salvar vendedor:', error);
                    alert('Erro ao salvar vendedor');
                } finally {
                    setLoading(false);
                }
            };

            const limparFormulario = () => {
                setFormVendedor({
                    nome_completo: '',
                    cpf: '',
                    email: '',
                    telefone: '',
                    celular: '',
                    data_nascimento: '',
                    cep: '',
                    logradouro: '',
                    numero: '',
                    complemento: '',
                    bairro: '',
                    cidade: '',
                    estado: '',
                    banco: '',
                    agencia: '',
                    conta: '',
                    tipo_conta: 'corrente',
                    pix: '',
                    rg: '',
                    comissao_percentual: '5.00',
                    meta_mensal: '0',
                    codigo_vendedor: '',
                    observacoes: '',
                    status: 'ativo'
                });
                setArquivos({
                    rg_frente: null,
                    rg_verso: null,
                    comprovante_residencia: null
                });
                setVendedorSelecionado(null);
                setErrors({});
            };

            const editarVendedor = (vendedor) => {
                setVendedorSelecionado(vendedor);
                setFormVendedor({
                    nome_completo: vendedor.nome_completo || '',
                    cpf: vendedor.cpf || '',
                    email: vendedor.email || '',
                    telefone: vendedor.telefone || '',
                    celular: vendedor.celular || '',
                    data_nascimento: vendedor.data_nascimento || '',
                    cep: vendedor.cep || '',
                    logradouro: vendedor.logradouro || '',
                    numero: vendedor.numero || '',
                    complemento: vendedor.complemento || '',
                    bairro: vendedor.bairro || '',
                    cidade: vendedor.cidade || '',
                    estado: vendedor.estado || '',
                    banco: vendedor.banco || '',
                    agencia: vendedor.agencia || '',
                    conta: vendedor.conta || '',
                    tipo_conta: vendedor.tipo_conta || 'corrente',
                    pix: vendedor.pix || '',
                    rg: vendedor.rg || '',
                    comissao_percentual: vendedor.comissao_percentual?.toString() || '5.00',
                    meta_mensal: vendedor.meta_mensal?.toString() || '0',
                    codigo_vendedor: vendedor.codigo_vendedor || '',
                    observacoes: vendedor.observacoes || '',
                    status: vendedor.status || 'ativo'
                });
                setMostrarFormulario(true);
            };

            const alterarStatusVendedor = async (vendedor, novoStatus) => {
                if (!confirm(`Deseja ${novoStatus === 'inativo' ? 'desativar' : 'ativar'} o vendedor ${vendedor.nome_completo}?`)) {
                    return;
                }

                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/vendedores?id=eq.${vendedor.id}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'apikey': SUPABASE_KEY,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: novoStatus })
                    });

                    if (response.ok) {
                        alert('Status atualizado com sucesso!');
                        carregarVendedores();
                    }
                } catch (error) {
                    console.error('Erro ao alterar status:', error);
                    alert('Erro ao alterar status');
                }
            };

            const vendedoresFiltrados = vendedores.filter(v => {
                const matchStatus = filtroStatus === 'todos' || v.status === filtroStatus;
                const matchBusca = !busca || 
                    v.nome_completo?.toLowerCase().includes(busca.toLowerCase()) ||
                    v.email?.toLowerCase().includes(busca.toLowerCase()) ||
                    v.codigo_vendedor?.toLowerCase().includes(busca.toLowerCase()) ||
                    v.cpf?.includes(busca);
                return matchStatus && matchBusca;
            });

            const formatarCPF = (cpf) => {
                if (!cpf) return '';
                cpf = cpf.replace(/\D/g, '');
                return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            };

            const formatarTelefone = (tel) => {
                if (!tel) return '';
                tel = tel.replace(/\D/g, '');
                if (tel.length === 11) {
                    return tel.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                }
                return tel.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            };

            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="flex justify-between items-center mb-6 border-b pb-4">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800">👥 Gestão de Vendedores</h2>
                            <p className="text-sm text-gray-600 mt-1">Cadastre e gerencie vendedores da OBY Energy</p>
                        </div>
                        <button 
                            onClick={() => {
                                limparFormulario();
                                setMostrarFormulario(true);
                            }}
                            className="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 flex items-center gap-2"
                        >
                            ➕ Novo Vendedor
                        </button>
                    </div>

                    {/* Filtros */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <input
                                type="text"
                                placeholder="🔍 Buscar por nome, email, CPF ou código..."
                                value={busca}
                                onChange={(e) => setBusca(e.target.value)}
                                className="w-full p-3 border border-gray-300 rounded-lg"
                            />
                        </div>
                        <div>
                            <select
                                value={filtroStatus}
                                onChange={(e) => setFiltroStatus(e.target.value)}
                                className="w-full p-3 border border-gray-300 rounded-lg"
                            >
                                <option value="todos">Todos os Status</option>
                                <option value="ativo">Ativos</option>
                                <option value="inativo">Inativos</option>
                                <option value="suspenso">Suspensos</option>
                            </select>
                        </div>
                    </div>

                    {/* Estatísticas */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div className="bg-blue-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Total</p>
                            <p className="text-2xl font-bold text-blue-800">{vendedores.length}</p>
                        </div>
                        <div className="bg-green-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Ativos</p>
                            <p className="text-2xl font-bold text-green-800">
                                {vendedores.filter(v => v.status === 'ativo').length}
                            </p>
                        </div>
                        <div className="bg-yellow-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Inativos</p>
                            <p className="text-2xl font-bold text-yellow-800">
                                {vendedores.filter(v => v.status === 'inativo').length}
                            </p>
                        </div>
                        <div className="bg-purple-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Com Vendas</p>
                            <p className="text-2xl font-bold text-purple-800">
                                {vendedores.filter(v => v.ultima_venda).length}
                            </p>
                        </div>
                    </div>

                    {/* Lista de Vendedores */}
                    {loading ? (
                        <div className="text-center py-8">
                            <p className="text-gray-600">⏳ Carregando vendedores...</p>
                        </div>
                    ) : vendedoresFiltrados.length === 0 ? (
                        <div className="text-center py-8 bg-gray-50 rounded-lg">
                            <p className="text-gray-600">📭 Nenhum vendedor encontrado</p>
                        </div>
                    ) : (
                        <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Código</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">CPF</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Telefone</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Comissão</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ações</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {vendedoresFiltrados.map(vendedor => (
                                        <tr key={vendedor.id} className="hover:bg-gray-50">
                                            <td className="px-4 py-3 text-sm font-mono text-gray-900">
                                                {vendedor.codigo_vendedor}
                                            </td>
                                            <td className="px-4 py-3 text-sm text-gray-900">
                                                {vendedor.nome_completo}
                                            </td>
                                            <td className="px-4 py-3 text-sm text-gray-600">
                                                {formatarCPF(vendedor.cpf)}
                                            </td>
                                            <td className="px-4 py-3 text-sm text-gray-600">
                                                {vendedor.email}
                                            </td>
                                            <td className="px-4 py-3 text-sm text-gray-600">
                                                {formatarTelefone(vendedor.telefone)}
                                            </td>
                                            <td className="px-4 py-3 text-sm font-semibold text-green-600">
                                                {vendedor.comissao_percentual}%
                                            </td>
                                            <td className="px-4 py-3 text-sm">
                                                <span className={`px-2 py-1 rounded-full text-xs font-semibold ${
                                                    vendedor.status === 'ativo' ? 'bg-green-100 text-green-800' :
                                                    vendedor.status === 'inativo' ? 'bg-gray-100 text-gray-800' :
                                                    'bg-red-100 text-red-800'
                                                }`}>
                                                    {vendedor.status === 'ativo' ? '✅ Ativo' :
                                                     vendedor.status === 'inativo' ? '⏸️ Inativo' :
                                                     '🚫 Suspenso'}
                                                </span>
                                            </td>
                                            <td className="px-4 py-3 text-sm">
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            setVendedorSelecionado(vendedor);
                                                            setMostrarDetalhes(true);
                                                        }}
                                                        className="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"
                                                        title="Ver detalhes"
                                                    >
                                                        👁️
                                                    </button>
                                                    <button
                                                        onClick={() => editarVendedor(vendedor)}
                                                        className="px-3 py-1 bg-yellow-600 text-white rounded hover:bg-yellow-700"
                                                        title="Editar"
                                                    >
                                                        ✏️
                                                    </button>
                                                    {vendedor.status === 'ativo' ? (
                                                        <button
                                                            onClick={() => alterarStatusVendedor(vendedor, 'inativo')}
                                                            className="px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"
                                                            title="Desativar"
                                                        >
                                                            ⏸️
                                                        </button>
                                                    ) : (
                                                        <button
                                                            onClick={() => alterarStatusVendedor(vendedor, 'ativo')}
                                                            className="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700"
                                                            title="Ativar"
                                                        >
                                                            ▶️
                                                        </button>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* Modal Formulário */}
                    {mostrarFormulario && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-4xl my-8">
                                <div className="bg-gradient-to-r from-green-600 to-green-700 p-6 rounded-t-xl">
                                    <h3 className="text-2xl font-bold text-white">
                                        {vendedorSelecionado ? '✏️ Editar Vendedor' : '➕ Novo Vendedor'}
                                    </h3>
                                </div>
                                
                                <div className="p-6 max-h-[70vh] overflow-y-auto">
                                    <div className="space-y-6">
                                        {/* Dados Pessoais */}
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-4 text-blue-900">👤 Dados Pessoais</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Nome Completo *</label>
                                                    <input
                                                        type="text"
                                                        name="nome_completo"
                                                        value={formVendedor.nome_completo}
                                                        onChange={handleInputChange}
                                                        className={`w-full p-3 border rounded-lg ${errors.nome_completo ? 'border-red-500' : 'border-gray-300'}`}
                                                    />
                                                    {errors.nome_completo && <p className="text-red-500 text-sm mt-1">{errors.nome_completo}</p>}
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">CPF *</label>
                                                    <input
                                                        type="text"
                                                        name="cpf"
                                                        value={formVendedor.cpf}
                                                        onChange={handleInputChange}
                                                        placeholder="000.000.000-00"
                                                        className={`w-full p-3 border rounded-lg ${errors.cpf ? 'border-red-500' : 'border-gray-300'}`}
                                                    />
                                                    {errors.cpf && <p className="text-red-500 text-sm mt-1">{errors.cpf}</p>}
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">RG</label>
                                                    <input
                                                        type="text"
                                                        name="rg"
                                                        value={formVendedor.rg}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Data de Nascimento</label>
                                                    <input
                                                        type="date"
                                                        name="data_nascimento"
                                                        value={formVendedor.data_nascimento}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Contato */}
                                        <div className="bg-purple-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-4 text-purple-900">📞 Contato</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Email *</label>
                                                    <input
                                                        type="email"
                                                        name="email"
                                                        value={formVendedor.email}
                                                        onChange={handleInputChange}
                                                        className={`w-full p-3 border rounded-lg ${errors.email ? 'border-red-500' : 'border-gray-300'}`}
                                                    />
                                                    {errors.email && <p className="text-red-500 text-sm mt-1">{errors.email}</p>}
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Telefone *</label>
                                                    <input
                                                        type="text"
                                                        name="telefone"
                                                        value={formVendedor.telefone}
                                                        onChange={handleInputChange}
                                                        placeholder="(00) 0000-0000"
                                                        className={`w-full p-3 border rounded-lg ${errors.telefone ? 'border-red-500' : 'border-gray-300'}`}
                                                    />
                                                    {errors.telefone && <p className="text-red-500 text-sm mt-1">{errors.telefone}</p>}
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Celular</label>
                                                    <input
                                                        type="text"
                                                        name="celular"
                                                        value={formVendedor.celular}
                                                        onChange={handleInputChange}
                                                        placeholder="(00) 00000-0000"
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Endereço */}
                                        <div className="bg-green-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-4 text-green-900">📍 Endereço</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">CEP</label>
                                                    <input
                                                        type="text"
                                                        name="cep"
                                                        value={formVendedor.cep}
                                                        onChange={handleInputChange}
                                                        placeholder="00000-000"
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Logradouro</label>
                                                    <input
                                                        type="text"
                                                        name="logradouro"
                                                        value={formVendedor.logradouro}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Número</label>
                                                    <input
                                                        type="text"
                                                        name="numero"
                                                        value={formVendedor.numero}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Complemento</label>
                                                    <input
                                                        type="text"
                                                        name="complemento"
                                                        value={formVendedor.complemento}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Bairro</label>
                                                    <input
                                                        type="text"
                                                        name="bairro"
                                                        value={formVendedor.bairro}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Cidade</label>
                                                    <input
                                                        type="text"
                                                        name="cidade"
                                                        value={formVendedor.cidade}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Estado</label>
                                                    <input
                                                        type="text"
                                                        name="estado"
                                                        value={formVendedor.estado}
                                                        onChange={handleInputChange}
                                                        placeholder="PR"
                                                        maxLength="2"
                                                        className="w-full p-3 border border-gray-300 rounded-lg uppercase"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Dados Bancários */}
                                        <div className="bg-yellow-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-4 text-yellow-900">💳 Dados Bancários (Pagamento de Comissões)</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Banco</label>
                                                    <input
                                                        type="text"
                                                        name="banco"
                                                        value={formVendedor.banco}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Agência</label>
                                                    <input
                                                        type="text"
                                                        name="agencia"
                                                        value={formVendedor.agencia}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Conta</label>
                                                    <input
                                                        type="text"
                                                        name="conta"
                                                        value={formVendedor.conta}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Tipo de Conta</label>
                                                    <select
                                                        name="tipo_conta"
                                                        value={formVendedor.tipo_conta}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    >
                                                        <option value="corrente">Corrente</option>
                                                        <option value="poupanca">Poupança</option>
                                                    </select>
                                                </div>
                                                <div className="md:col-span-2">
                                                    <label className="block text-sm font-medium mb-2">Chave PIX</label>
                                                    <input
                                                        type="text"
                                                        name="pix"
                                                        value={formVendedor.pix}
                                                        onChange={handleInputChange}
                                                        placeholder="CPF, Email, Telefone ou Chave Aleatória"
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Configurações de Vendas */}
                                        <div className="bg-indigo-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-4 text-indigo-900">💼 Configurações de Vendas</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Código do Vendedor *</label>
                                                    <input
                                                        type="text"
                                                        name="codigo_vendedor"
                                                        value={formVendedor.codigo_vendedor}
                                                        onChange={handleInputChange}
                                                        placeholder="VEND001"
                                                        className={`w-full p-3 border rounded-lg uppercase ${errors.codigo_vendedor ? 'border-red-500' : 'border-gray-300'}`}
                                                    />
                                                    {errors.codigo_vendedor && <p className="text-red-500 text-sm mt-1">{errors.codigo_vendedor}</p>}
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Comissão (%) *</label>
                                                    <input
                                                        type="number"
                                                        name="comissao_percentual"
                                                        value={formVendedor.comissao_percentual}
                                                        onChange={handleInputChange}
                                                        min="0"
                                                        max="100"
                                                        step="0.01"
                                                        className={`w-full p-3 border rounded-lg ${errors.comissao_percentual ? 'border-red-500' : 'border-gray-300'}`}
                                                    />
                                                    {errors.comissao_percentual && <p className="text-red-500 text-sm mt-1">{errors.comissao_percentual}</p>}
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Meta Mensal</label>
                                                    <input
                                                        type="number"
                                                        name="meta_mensal"
                                                        value={formVendedor.meta_mensal}
                                                        onChange={handleInputChange}
                                                        min="0"
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                                <div className="md:col-span-3">
                                                    <label className="block text-sm font-medium mb-2">Status</label>
                                                    <select
                                                        name="status"
                                                        value={formVendedor.status}
                                                        onChange={handleInputChange}
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    >
                                                        <option value="ativo">✅ Ativo</option>
                                                        <option value="inativo">⏸️ Inativo</option>
                                                        <option value="suspenso">🚫 Suspenso</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Documentos */}
                                        <div className="bg-orange-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-4 text-orange-900">📄 Documentos</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">RG/CNH (Frente)</label>
                                                    <input
                                                        type="file"
                                                        name="rg_frente"
                                                        onChange={handleFileChange}
                                                        accept=".pdf,.jpg,.jpeg,.png"
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                    {arquivos.rg_frente && <p className="text-green-600 text-sm mt-1">✓ {arquivos.rg_frente.name}</p>}
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">RG/CNH (Verso)</label>
                                                    <input
                                                        type="file"
                                                        name="rg_verso"
                                                        onChange={handleFileChange}
                                                        accept=".pdf,.jpg,.jpeg,.png"
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                    {arquivos.rg_verso && <p className="text-green-600 text-sm mt-1">✓ {arquivos.rg_verso.name}</p>}
                                                </div>
                                                <div className="md:col-span-2">
                                                    <label className="block text-sm font-medium mb-2">Comprovante de Residência</label>
                                                    <input
                                                        type="file"
                                                        name="comprovante_residencia"
                                                        onChange={handleFileChange}
                                                        accept=".pdf,.jpg,.jpeg,.png"
                                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                                    />
                                                    {arquivos.comprovante_residencia && <p className="text-green-600 text-sm mt-1">✓ {arquivos.comprovante_residencia.name}</p>}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Observações */}
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Observações</label>
                                            <textarea
                                                name="observacoes"
                                                value={formVendedor.observacoes}
                                                onChange={handleInputChange}
                                                rows="3"
                                                className="w-full p-3 border border-gray-300 rounded-lg"
                                                placeholder="Informações adicionais sobre o vendedor..."
                                            />
                                        </div>
                                    </div>
                                </div>

                                <div className="p-6 border-t border-gray-200 flex justify-end gap-3">
                                    <button
                                        onClick={() => {
                                            setMostrarFormulario(false);
                                            limparFormulario();
                                        }}
                                        disabled={loading}
                                        className="px-6 py-3 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700 disabled:opacity-50"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={salvarVendedor}
                                        disabled={loading}
                                        className="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:opacity-50"
                                    >
                                        {loading ? '⏳ Salvando...' : vendedorSelecionado ? '💾 Atualizar' : '➕ Cadastrar'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal Detalhes */}
                    {mostrarDetalhes && vendedorSelecionado && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                                <div className="bg-gradient-to-r from-blue-600 to-blue-700 p-6 rounded-t-xl">
                                    <h3 className="text-2xl font-bold text-white">👤 Detalhes do Vendedor</h3>
                                </div>
                                
                                <div className="p-6 space-y-6">
                                    {/* Info Básica */}
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-bold text-lg mb-3">Informações Básicas</h4>
                                        <div className="grid grid-cols-2 gap-3 text-sm">
                                            <div><span className="font-semibold">Código:</span> {vendedorSelecionado.codigo_vendedor}</div>
                                            <div><span className="font-semibold">Nome:</span> {vendedorSelecionado.nome_completo}</div>
                                            <div><span className="font-semibold">CPF:</span> {formatarCPF(vendedorSelecionado.cpf)}</div>
                                            <div><span className="font-semibold">RG:</span> {vendedorSelecionado.rg || 'Não informado'}</div>
                                            <div><span className="font-semibold">Email:</span> {vendedorSelecionado.email}</div>
                                            <div><span className="font-semibold">Telefone:</span> {formatarTelefone(vendedorSelecionado.telefone)}</div>
                                            {vendedorSelecionado.celular && (
                                                <div><span className="font-semibold">Celular:</span> {formatarTelefone(vendedorSelecionado.celular)}</div>
                                            )}
                                            <div><span className="font-semibold">Status:</span> 
                                                <span className={`ml-2 px-2 py-1 rounded-full text-xs font-semibold ${
                                                    vendedorSelecionado.status === 'ativo' ? 'bg-green-100 text-green-800' :
                                                    vendedorSelecionado.status === 'inativo' ? 'bg-gray-100 text-gray-800' :
                                                    'bg-red-100 text-red-800'
                                                }`}>
                                                    {vendedorSelecionado.status}
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Endereço */}
                                    {(vendedorSelecionado.logradouro || vendedorSelecionado.cidade) && (
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-3">📍 Endereço</h4>
                                            <p className="text-sm">
                                                {vendedorSelecionado.logradouro && `${vendedorSelecionado.logradouro}, `}
                                                {vendedorSelecionado.numero && `${vendedorSelecionado.numero}`}
                                                {vendedorSelecionado.complemento && ` - ${vendedorSelecionado.complemento}`}
                                                <br/>
                                                {vendedorSelecionado.bairro && `${vendedorSelecionado.bairro} - `}
                                                {vendedorSelecionado.cidade && `${vendedorSelecionado.cidade}`}
                                                {vendedorSelecionado.estado && `/${vendedorSelecionado.estado}`}
                                                {vendedorSelecionado.cep && <><br/>CEP: {vendedorSelecionado.cep}</>}
                                            </p>
                                        </div>
                                    )}

                                    {/* Dados Bancários */}
                                    {(vendedorSelecionado.banco || vendedorSelecionado.pix) && (
                                        <div className="bg-green-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-3">💳 Dados Bancários</h4>
                                            <div className="grid grid-cols-2 gap-3 text-sm">
                                                {vendedorSelecionado.banco && <div><span className="font-semibold">Banco:</span> {vendedorSelecionado.banco}</div>}
                                                {vendedorSelecionado.agencia && <div><span className="font-semibold">Agência:</span> {vendedorSelecionado.agencia}</div>}
                                                {vendedorSelecionado.conta && <div><span className="font-semibold">Conta:</span> {vendedorSelecionado.conta}</div>}
                                                {vendedorSelecionado.tipo_conta && <div><span className="font-semibold">Tipo:</span> {vendedorSelecionado.tipo_conta}</div>}
                                                {vendedorSelecionado.pix && <div className="col-span-2"><span className="font-semibold">PIX:</span> {vendedorSelecionado.pix}</div>}
                                            </div>
                                        </div>
                                    )}

                                    {/* Comissão e Metas */}
                                    <div className="bg-yellow-50 p-4 rounded-lg">
                                        <h4 className="font-bold text-lg mb-3">💼 Comissão e Metas</h4>
                                        <div className="grid grid-cols-2 gap-3 text-sm">
                                            <div><span className="font-semibold">Comissão:</span> <span className="text-lg font-bold text-green-600">{vendedorSelecionado.comissao_percentual}%</span></div>
                                            <div><span className="font-semibold">Meta Mensal:</span> {vendedorSelecionado.meta_mensal} vendas</div>
                                        </div>
                                    </div>

                                    {/* Documentos */}
                                    <div className="bg-purple-50 p-4 rounded-lg">
                                        <h4 className="font-bold text-lg mb-3">📄 Documentos</h4>
                                        <div className="space-y-2">
                                            {vendedorSelecionado.arquivo_rg_frente_url && (
                                                <div className="flex justify-between items-center">
                                                    <span className="text-sm">🪪 RG/CNH (Frente)</span>
                                                    <a href={vendedorSelecionado.arquivo_rg_frente_url} target="_blank" rel="noopener noreferrer" className="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                                        Ver
                                                    </a>
                                                </div>
                                            )}
                                            {vendedorSelecionado.arquivo_rg_verso_url && (
                                                <div className="flex justify-between items-center">
                                                    <span className="text-sm">🪪 RG/CNH (Verso)</span>
                                                    <a href={vendedorSelecionado.arquivo_rg_verso_url} target="_blank" rel="noopener noreferrer" className="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                                        Ver
                                                    </a>
                                                </div>
                                            )}
                                            {vendedorSelecionado.arquivo_comprovante_residencia_url && (
                                                <div className="flex justify-between items-center">
                                                    <span className="text-sm">📄 Comprovante de Residência</span>
                                                    <a href={vendedorSelecionado.arquivo_comprovante_residencia_url} target="_blank" rel="noopener noreferrer" className="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                                        Ver
                                                    </a>
                                                </div>
                                            )}
                                            {!vendedorSelecionado.arquivo_rg_frente_url && !vendedorSelecionado.arquivo_rg_verso_url && !vendedorSelecionado.arquivo_comprovante_residencia_url && (
                                                <p className="text-sm text-gray-600">Nenhum documento anexado</p>
                                            )}
                                        </div>
                                    </div>

                                    {/* Observações */}
                                    {vendedorSelecionado.observacoes && (
                                        <div className="bg-gray-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-lg mb-3">📝 Observações</h4>
                                            <p className="text-sm whitespace-pre-wrap">{vendedorSelecionado.observacoes}</p>
                                        </div>
                                    )}

                                    {/* Auditoria */}
                                    <div className="bg-gray-100 p-4 rounded-lg">
                                        <h4 className="font-bold text-lg mb-3">🕐 Informações do Sistema</h4>
                                        <div className="grid grid-cols-2 gap-3 text-sm text-gray-600">
                                            <div><span className="font-semibold">Cadastrado em:</span> {new Date(vendedorSelecionado.data_cadastro).toLocaleString('pt-BR')}</div>
                                            {vendedorSelecionado.data_atualizacao && (
                                                <div><span className="font-semibold">Última atualização:</span> {new Date(vendedorSelecionado.data_atualizacao).toLocaleString('pt-BR')}</div>
                                            )}
                                            {vendedorSelecionado.ultima_venda && (
                                                <div><span className="font-semibold">Última venda:</span> {new Date(vendedorSelecionado.ultima_venda).toLocaleString('pt-BR')}</div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div className="p-6 border-t border-gray-200 flex justify-end">
                                    <button
                                        onClick={() => {
                                            setMostrarDetalhes(false);
                                            setVendedorSelecionado(null);
                                        }}
                                        className="px-6 py-3 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700"
                                    >
                                        Fechar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- COMPONENTE PRINCIPAL: PAINEL ADMINISTRATIVO ---
        function AdminPanel() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [abaAtiva, setAbaAtiva] = useState('propostas');

            const handleLogin = (e) => {
                e.preventDefault();
                if (username === ADMIN_USER && password === ADMIN_PASS) {
                    setIsLoggedIn(true);
                    setError('');
                } else {
                    setError('Usuário ou senha incorretos');
                }
            };

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">OBY Energy</h1>
                                <p className="text-gray-600">Painel Administrativo</p>
                            </div>
                            <form onSubmit={handleLogin} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Usuário</label>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required
                                    />
                                </div>
                                {error && <p className="text-red-600 text-sm text-center">{error}</p>}
                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200"
                                >
                                    Entrar
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-blue-600 to-purple-700 text-white shadow-lg">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold">OBY Energy</h1>
                                    <p className="text-blue-100 mt-1">Painel Administrativo</p>
                                </div>
                                <button
                                    onClick={() => setIsLoggedIn(false)}
                                    className="px-6 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg font-semibold transition duration-200"
                                >
                                    🚪 Sair
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Navegação por Abas */}
                    <div className="bg-white shadow-md border-b">
                        <div className="container mx-auto px-4">
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setAbaAtiva('propostas')}
                                    className={`px-6 py-4 font-semibold transition-all ${
                                        abaAtiva === 'propostas'
                                            ? 'border-b-4 border-blue-600 text-blue-600'
                                            : 'text-gray-600 hover:text-blue-600'
                                    }`}
                                >
                                    📋 Propostas
                                </button>
                                <button
                                    onClick={() => setAbaAtiva('vendedores')}
                                    className={`px-6 py-4 font-semibold transition-all ${
                                        abaAtiva === 'vendedores'
                                            ? 'border-b-4 border-green-600 text-green-600'
                                            : 'text-gray-600 hover:text-green-600'
                                    }`}
                                >
                                    👥 Vendedores
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Conteúdo */}
                    <main className="container mx-auto px-4 py-8">
                        {abaAtiva === 'propostas' && (
                            <div className="text-center py-20 bg-white rounded-xl shadow-lg">
                                <p className="text-xl text-gray-600">
                                    📋 Módulo de Propostas<br/>
                                    <span className="text-sm">Cole aqui o código original do painel de propostas</span>
                                </p>
                            </div>
                        )}
                        {abaAtiva === 'vendedores' && <VendedoresGestao />}
                    </main>

                    {/* Footer */}
                    <footer className="bg-gray-800 text-white py-6 mt-12">
                        <div className="container mx-auto px-4 text-center">
                            <p>&copy; 2025 OBY Energy. Todos os direitos reservados.</p>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<AdminPanel />, document.getElementById('root'));
    </script>
</body>
</html>