<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBY Energy - Admin com Vendedor</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script> 
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const SUPABASE_URL = 'https://uuaqmwnfjopgjmjjchmw.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1YXFtd25mam9wZ2ptampjaG13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1OTEyNzUsImV4cCI6MjA3NjE2NzI3NX0.9ITSBR9SNoZKgvF1AuW4OsL4b8Du5NAXttQpi7B3MO8';
        const ADMIN_USER = 'admin';
        const ADMIN_PASS = 'oby2025';

        function FinancialReport({ propostas }) {
            const propostasAprovadas = propostas.filter(p => p.status === 'aprovado' && p.simulacao_economia_mensal > 0);
            const formatarMoeda = (valor) => {
                const num = parseFloat(valor); 
                if (isNaN(num)) return 'R$ 0,00';
                return num.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            };
            const exportarParaCSV = () => {
                const cabecalho = ["N¬∫ Contrato", "Vendedor", "Cliente", "Email", "Cidade", "Consumo (kWh)", "Custo Atual (R$)", "Custo OBY (R$)", "Desconto Aplicado (%)", "Economia Mensal (R$)", "Status"];
                const linhas = propostasAprovadas.map(p => {
                    const nomeCliente = p.nome && p.sobrenome ? `${p.nome} ${p.sobrenome}` : p.nome_fantasia || 'Sem nome';
                    return [`"${p.numero_contrato || 'N/A'}"`, `"${p.vendedor || 'Sem Vendedor'}"`, `"${nomeCliente}"`, `"${p.email || ''}"`, `"${p.cidade || ''}"`, `"${p.consumo_kwh || 0}"`, `"${formatarMoeda(p.simulacao_conta_atual).replace('R$', '').trim()}"`, `"${formatarMoeda(p.simulacao_conta_nova).replace('R$', '').trim()}"`, `"${p.desconto_aplicado || 0}"`, `"${formatarMoeda(p.simulacao_economia_mensal).replace('R$', '').trim()}"`, `"${p.status}"`].join(';');
                });
                const csvContent = [cabecalho.join(';'), ...linhas].join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `relatorio_oby_financeiro_${new Date().toISOString().slice(0,10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                alert("Exporta√ß√£o iniciada! Verifique seus downloads.");
            };
            const totalEconomiaMensal = propostasAprovadas.reduce((sum, p) => sum + (parseFloat(p.simulacao_economia_mensal) || 0), 0);
            const totalCustoAtual = propostasAprovadas.reduce((sum, p) => sum + (parseFloat(p.simulacao_conta_atual) || 0), 0);
            const totalCustoNovo = propostasAprovadas.reduce((sum, p) => sum + (parseFloat(p.simulacao_conta_nova) || 0), 0);
            return (<div className="bg-white rounded-xl shadow-lg p-6"><div className="flex justify-between items-center mb-6 border-b pb-4"><h2 className="text-2xl font-bold text-gray-800">üìä Relat√≥rio Financeiro de Propostas Aprovadas</h2><button onClick={exportarParaCSV} className="px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:opacity-50" disabled={propostasAprovadas.length === 0}>‚¨áÔ∏è Exportar para CSV</button></div><div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"><div className="bg-blue-50 p-4 rounded-lg"><p className="text-sm text-gray-600">Propostas V√°lidas</p><p className="text-2xl font-bold text-blue-800">{propostasAprovadas.length}</p></div><div className="bg-green-50 p-4 rounded-lg"><p className="text-sm text-gray-600">Total Economia Mensal</p><p className="text-xl font-bold text-green-800">{formatarMoeda(totalEconomiaMensal)}</p></div><div className="bg-yellow-50 p-4 rounded-lg"><p className="text-sm text-gray-600">Soma Custo Atual</p><p className="text-xl font-bold text-yellow-800">{formatarMoeda(totalCustoAtual)}</p></div><div className="bg-red-50 p-4 rounded-lg"><p className="text-sm text-gray-600">Soma Custo OBY</p><p className="text-xl font-bold text-red-800">{formatarMoeda(totalCustoNovo)}</p></div></div><div className="overflow-x-auto"><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">N¬∫ Contrato</th><th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Cliente / Vendedor</th><th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Consumo (kWh)</th><th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Custo Atual</th><th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Custo OBY</th><th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Desconto (%)</th><th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Economia Mensal</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{propostasAprovadas.length === 0 ? (<tr><td colSpan="7" className="px-4 py-4 text-center text-gray-500">Nenhuma proposta aprovada com economia calculada para o relat√≥rio.</td></tr>) : (propostasAprovadas.map(p => {const nomeCliente = p.nome && p.sobrenome ? `${p.nome} ${p.sobrenome}` : p.nome_fantasia || 'Sem nome';return (<tr key={p.id}><td className="px-4 py-3 text-sm font-medium text-blue-600">{p.numero_contrato || '-'}</td><td className="px-4 py-3 text-sm text-gray-900">{nomeCliente}<div className="text-xs text-gray-500">Vendedor: {p.vendedor || 'N/A'}</div></td><td className="px-4 py-3 text-sm text-right text-gray-600">{p.consumo_kwh || 0} kWh</td><td className="px-4 py-3 text-sm text-right text-red-600 font-semibold">{formatarMoeda(p.simulacao_conta_atual)}</td><td className="px-4 py-3 text-sm text-right text-green-600 font-semibold">{formatarMoeda(p.simulacao_conta_nova)}</td><td className="px-4 py-3 text-sm text-right text-gray-600">{p.desconto_aplicado || 0}%</td><td className="px-4 py-3 text-sm text-right font-bold text-green-800">{formatarMoeda(p.simulacao_economia_mensal)}</td></tr>);}))}</tbody></table></div></div>);
        }

        function EditPropostaModal({ proposta, onClose, onSave, saving }) {
            const editableColumns = ['nome', 'sobrenome', 'nome_fantasia', 'email', 'telefone', 'cep', 'cidade', 'estado', 'cpf', 'cnpj', 'logradouro', 'numero_endereco', 'complemento', 'consumo_kwh', 'distribuidora_energia', 'status', 'tipo_pessoa', 'numero_instalacao', 'tipo_conexao', 'vendedor'];
            const [formData, setFormData] = useState({...proposta, nome: proposta.nome || '', sobrenome: proposta.sobrenome || '', cpf: proposta.cpf || '', cnpj: proposta.cnpj || '', logradouro: proposta.logradouro || '', numero_endereco: proposta.numero_endereco || '', complemento: proposta.complemento || '', consumo_kwh: proposta.consumo_kwh || 0, distribuidora_energia: proposta.distribuidora_energia || '', vendedor: proposta.vendedor || ''});
            const handleChange = (e) => {const { name, value } = e.target;setFormData(prev => ({ ...prev, [name]: value }));};
            const handleSave = () => {const dataToSave = { id: formData.id };if (!formData.numero_contrato || formData.numero_contrato === '-') {const anoAtual = new Date().getFullYear();const idCurto = String(formData.id).slice(-5);dataToSave.numero_contrato = `OBY-${anoAtual}-${idCurto}`;}editableColumns.forEach(column => {if (formData.hasOwnProperty(column)) {let value = formData[column];if (column === 'consumo_kwh') {value = Number(value);}dataToSave[column] = value;}});onSave(dataToSave);};
            const inputClass = "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150";
            const labelClass = "block text-sm font-medium text-gray-700 mb-1";
            return (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div className="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col"><div className="p-6 border-b border-gray-200"><h2 className="text-2xl font-bold text-gray-800">üìù Editar Proposta: {proposta.numero_contrato || 'N/A'}</h2><p className="text-sm text-gray-500">Altere os dados da proposta do cliente. O N√∫mero do Contrato n√£o pode ser editado.</p></div><div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto"><div className="md:col-span-2 bg-gray-100 p-4 rounded-lg border-l-4 border-gray-400"><h3 className="font-bold text-lg mb-3 text-gray-700">Detalhes de Identifica√ß√£o</h3><div className="space-y-3"><div><label className={labelClass}>N√∫mero do Contrato</label><input type="text" value={proposta.numero_contrato || 'N/A'} disabled className={`${inputClass} bg-gray-200 cursor-not-allowed text-gray-700 font-semibold`} /></div></div></div><div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400"><h3 className="font-bold text-lg mb-4 text-blue-800">Dados Pessoais</h3><div className="space-y-4"><div><label className={labelClass}>Nome</label><input type="text" name="nome" value={formData.nome} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Sobrenome</label><input type="text" name="sobrenome" value={formData.sobrenome} onChange={handleChange} className={inputClass} /></div>{formData.tipo_pessoa === 'juridica' && (<div><label className={labelClass}>Nome Fantasia</label><input type="text" name="nome_fantasia" value={formData.nome_fantasia || ''} onChange={handleChange} className={inputClass} /></div>)}<div><label className={labelClass}>Email</label><input type="email" name="email" value={formData.email || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Telefone</label><input type="text" name="telefone" value={formData.telefone || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>{formData.tipo_pessoa === 'fisica' ? 'CPF' : 'CNPJ'}</label><input type="text" name={formData.tipo_pessoa === 'fisica' ? 'cpf' : 'cnpj'} value={formData.tipo_pessoa === 'fisica' ? formData.cpf || '' : formData.cnpj || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Vendedor</label><input type="text" name="vendedor" value={formData.vendedor || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Status da Proposta</label><select name="status" value={formData.status || 'pendente'} onChange={handleChange} className={inputClass}><option value="pendente">üü° Pendente</option><option value="aprovado">üü¢ Aprovado</option><option value="reprovado">üî¥ Reprovado</option><option value="lista_espera">üü† Lista de Espera</option></select></div></div></div><div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-400"><h3 className="font-bold text-lg mb-4 text-green-800">Endere√ßo e Instala√ß√£o</h3><div className="space-y-4"><div><label className={labelClass}>CEP</label><input type="text" name="cep" value={formData.cep || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Logradouro</label><input type="text" name="logradouro" value={formData.logradouro || ''} onChange={handleChange} className={inputClass} /></div><div className="grid grid-cols-2 gap-4"><div><label className={labelClass}>N√∫mero</label><input type="text" name="numero_endereco" value={formData.numero_endereco || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Complemento</label><input type="text" name="complemento" value={formData.complemento || ''} onChange={handleChange} className={inputClass} /></div></div><div className="grid grid-cols-2 gap-4"><div><label className={labelClass}>Cidade</label><input type="text" name="cidade" value={formData.cidade || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Estado (UF)</label><input type="text" name="estado" value={formData.estado || ''} onChange={handleChange} className={inputClass} /></div></div><div><label className={labelClass}>Distribuidora</label><input type="text" name="distribuidora_energia" value={formData.distribuidora_energia || ''} onChange={handleChange} className={inputClass} /></div><div><label className={labelClass}>Consumo M√©dio (kWh)</label><input type="number" step="1" name="consumo_kwh" value={formData.consumo_kwh || 0} onChange={handleChange} className={inputClass} /></div></div></div></div><div className="p-6 flex justify-end gap-3 border-t border-gray-200"><button onClick={onClose} className="px-6 py-3 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600">Cancelar</button><button onClick={handleSave} disabled={saving} className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50">{saving ? 'Salvando...' : 'üíæ Salvar Altera√ß√µes'}</button></div></div></div>);
        }

        function VendedoresGestao() {/* [c√≥digo omitido por brevidade - mant√©m o mesmo] */return null;}

        function AdminPanel() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [propostas, setPropostas] = useState([]);
            const [loading, setLoading] = useState(false);
            const [selectedProposta, setSelectedProposta] = useState(null);
            const [propostaAnexos, setPropostaAnexos] = useState(null);
            const [savingProposta, setSavingProposta] = useState(false);
            const [filtro, setFiltro] = useState('todos');
            const [busca, setBusca] = useState('');
            const [activeTab, setActiveTab] = useState('propostas');

            useEffect(() => {
                const authStatus = localStorage.getItem('oby_admin_auth');
                if (authStatus === 'true') {
                    setIsAuthenticated(true);
                    carregarPropostas();
                }
            }, []);

            const handleLogin = (e) => {
                e.preventDefault();
                if (username === ADMIN_USER && password === ADMIN_PASS) {
                    setIsAuthenticated(true);
                    localStorage.setItem('oby_admin_auth', 'true');
                    carregarPropostas();
                } else {
                    alert('Usu√°rio ou senha incorretos!');
                }
            };

            const handleLogout = () => {
                setIsAuthenticated(false);
                localStorage.removeItem('oby_admin_auth');
                setUsername('');
                setPassword('');
            };

            const carregarPropostas = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/propostas?select=*,vendedores(nome_completo)&order=data_criacao.desc`, {headers: {'Authorization': `Bearer ${SUPABASE_KEY}`, 'apikey': SUPABASE_KEY}});
                    if (!response.ok) throw new Error(`Erro ${response.status}`);
                    const data = await response.json();
                    setPropostas(data.map(p => ({
                        ...p, 
                        vendedor: p.vendedores?.nome_completo || p.vendedor || '-',
                        showMenu: false, 
                        updating: false
                    })));
                } catch (error) {
                    console.error('‚ùå Erro ao carregar propostas:', error);
                    setPropostas([]);
                } finally {
                    setLoading(false);
                }
            };

            const handleEditClick = (proposta) => setSelectedProposta(proposta);

            const handleSaveEdit = async (dataToSave) => {
                setSavingProposta(true);
                const propostaId = dataToSave.id;
                const { id, ...payloadForSupabase } = dataToSave;
                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/propostas?id=eq.${propostaId}`, {method: 'PATCH', headers: {'Authorization': `Bearer ${SUPABASE_KEY}`, 'apikey': SUPABASE_KEY, 'Content-Type': 'application/json', 'Prefer': 'return=representation'}, body: JSON.stringify(payloadForSupabase)});
                    if (response.ok) {
                        const data = await response.json();
                        setPropostas(prev => prev.map(p => p.id === propostaId ? {...data[0], showMenu: false, updating: false} : p));
                        setSelectedProposta(null);
                        alert('‚úÖ Proposta atualizada com sucesso!');
                    } else {
                        alert('‚ùå Erro ao salvar proposta');
                    }
                } catch (error) {
                    alert('Erro inesperado ao salvar proposta.');
                } finally {
                    setSavingProposta(false);
                }
            };

            const formatarData = (dataISO) => new Date(dataISO).toLocaleDateString('pt-BR');

            const gerarContratoPDF = (proposta) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFont("helvetica");
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Contrato N¬∫: ${proposta.numero_contrato || 'N/A'}`, 20, 15);
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(18);
                doc.setFont("helvetica", "bold");
                doc.text("CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS", 105, 20, { align: "center" });
                doc.setFontSize(11);
                doc.setFont("helvetica", "normal");
                const nomeCompleto = proposta.nome && proposta.sobrenome ? `${proposta.nome} ${proposta.sobrenome}` : proposta.nome_fantasia || 'Sem nome';
                const cpfCnpj = proposta.tipo_pessoa === 'fisica' ? proposta.cpf : proposta.cnpj;
                doc.text(`CONTRATANTE: ${nomeCompleto}`, 20, 40);
                doc.text(`CPF/CNPJ: ${cpfCnpj}`, 20, 50);
                doc.text(`E-mail: ${proposta.email}`, 20, 60);
                doc.text(`Telefone: ${proposta.telefone}`, 20, 70);
                doc.text(`Endere√ßo: ${proposta.logradouro}, ${proposta.numero_endereco}`, 20, 80);
                doc.text(`${proposta.cidade} - ${proposta.estado}, CEP: ${proposta.cep}`, 20, 90);
                doc.text("CONTRATADA: OBY ENERGY", 20, 110);
                doc.save(`contrato_${nomeCompleto.replace(/\s+/g, '_')}.pdf`);
            };

            const getStatusBadge = (status) => {
                const configs = {
                    'pendente': { bg: 'bg-yellow-100', text: 'text-yellow-800', label: 'üü° Pendente' },
                    'aprovado': { bg: 'bg-green-100', text: 'text-green-800', label: 'üü¢ Aprovado' },
                    'reprovado': { bg: 'bg-red-100', text: 'text-red-800', label: 'üî¥ Reprovado' },
                    'lista_espera': { bg: 'bg-orange-100', text: 'text-orange-800', label: 'üü† Lista Espera' }
                };
                const config = configs[status] || configs['pendente'];
                return (<span className={`px-3 py-1 rounded-full text-xs font-semibold ${config.bg} ${config.text}`}>{config.label}</span>);
            };

            const propostasFiltradas = propostas.filter(proposta => {
                const matchFiltro = filtro === 'todos' || proposta.status === filtro;
                const nomeCompleto = proposta.nome && proposta.sobrenome ? `${proposta.nome} ${proposta.sobrenome}` : proposta.nome_fantasia || '';
                const matchBusca = busca === '' || nomeCompleto.toLowerCase().includes(busca.toLowerCase()) || proposta.email?.toLowerCase().includes(busca.toLowerCase()) || proposta.cidade?.toLowerCase().includes(busca.toLowerCase());
                return matchFiltro && matchBusca;
            });

            if (!isAuthenticated) {
                return (<div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4"><div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md"><div className="text-center mb-8"><h1 className="text-3xl font-bold text-gray-800 mb-2">üîê Admin OBY Energy</h1><p className="text-gray-600">Fa√ßa login para acessar o painel</p></div><form onSubmit={handleLogin} className="space-y-4"><div><label className="block text-sm font-medium text-gray-700 mb-2">Usu√°rio</label><input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required /></div><div><label className="block text-sm font-medium text-gray-700 mb-2">Senha</label><input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required /></div><button type="submit" className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Entrar</button></form></div></div>);
            }

            return (
                <div className="min-h-screen bg-gray-100">
                    <header className="bg-white shadow-md"><div className="container mx-auto px-4 py-4 flex justify-between items-center"><h1 className="text-2xl font-bold text-blue-600">‚ö° OBY Energy Admin</h1><button onClick={handleLogout} className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Sair</button></div></header>
                    <div className="container mx-auto px-4 py-8">
                        <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl shadow-lg p-6 text-white mb-6"><h2 className="text-3xl font-bold mb-2">Bem-vindo ao Painel Administrativo! üëã</h2><p className="text-blue-100">Gerencie as propostas de energia de forma simples e eficiente</p><div className="mt-4 flex gap-4"><div className="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2"><p className="text-sm">Total de Propostas</p><p className="text-2xl font-bold">{propostas.length}</p></div><div className="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2"><p className="text-sm">Pendentes</p><p className="text-2xl font-bold">{propostas.filter(p => p.status === 'pendente').length}</p></div><div className="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2"><p className="text-sm">Aprovadas</p><p className="text-2xl font-bold">{propostas.filter(p => p.status === 'aprovado').length}</p></div></div></div>
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <div className="mb-6 flex flex-col md:flex-row gap-4">
                                <input type="text" placeholder="üîç Buscar..." value={busca} onChange={(e) => setBusca(e.target.value)} className="flex-1 p-3 border border-gray-300 rounded-lg" />
                                <select value={filtro} onChange={(e) => setFiltro(e.target.value)} className="p-3 border border-gray-300 rounded-lg"><option value="todos">Todos</option><option value="pendente">Pendente</option><option value="aprovado">Aprovado</option><option value="reprovado">Reprovado</option><option value="lista_espera">Lista de Espera</option></select>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-50 border-b-2 border-gray-200">
                                        <tr>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Nome</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">N¬∫ Contrato</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Email</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Cidade</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Telefone</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">CPF</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase bg-yellow-50">üî• VENDEDOR</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Data</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th>
                                            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {propostasFiltradas.length === 0 ? (
                                            <tr><td colSpan="10" className="px-4 py-8 text-center text-gray-500">{loading ? 'Carregando...' : 'Nenhuma proposta encontrada'}</td></tr>
                                        ) : (
                                            propostasFiltradas.map((proposta) => {
                                                const nomeCompleto = proposta.nome && proposta.sobrenome ? `${proposta.nome} ${proposta.sobrenome}` : proposta.nome_fantasia || 'Sem nome';
                                                return (
                                                    <tr key={proposta.id} className="hover:bg-gray-50">
                                                        <td className="px-4 py-3 text-sm font-medium text-gray-900">{nomeCompleto}</td>
                                                        <td className="px-4 py-3 text-sm font-semibold text-blue-600">{proposta.numero_contrato || '-'}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{proposta.email}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{proposta.cidade}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{proposta.telefone}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{proposta.tipo_pessoa === 'fisica' ? proposta.cpf : proposta.cnpj}</td>
                                                        <td className="px-4 py-3 text-sm font-bold text-green-700 bg-yellow-50">{proposta.vendedor || '-'}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{formatarData(proposta.data_criacao)}</td>
                                                        <td className="px-4 py-3">{getStatusBadge(proposta.status || 'pendente')}</td>
                                                        <td className="px-4 py-3 flex gap-2">
                                                            <button onClick={() => setPropostaAnexos(proposta)} className="px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700">üëÅÔ∏è Anexos</button>
                                                            <button onClick={() => handleEditClick(proposta)} className="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">üìù Editar</button>
                                                            <button onClick={() => gerarContratoPDF(proposta)} className="px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700">üìÑ PDF</button>
                                                        </td>
                                                    </tr>
                                                );
                                            })
                                        )}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {selectedProposta && (<EditPropostaModal proposta={selectedProposta} onClose={() => setSelectedProposta(null)} onSave={handleSaveEdit} saving={savingProposta} />)}
                </div>
            );
        }

        ReactDOM.render(<AdminPanel />, document.getElementById('root'));
    </script>
</body>
</html>