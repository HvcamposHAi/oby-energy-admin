<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>OBY Energy - Painel Administrativo</title>
ย ย <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>ย
ย ย <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
ย ย <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
ย ย <div id="root"></div>

ย ย <script type="text/babel">
ย ย ย ย const { useState, useEffect } = React;

ย ย ย ย // Configuraรงรตes do Supabase (MANTIDAS)
ย ย ย ย const SUPABASE_URL = 'https://uuaqmwnfjopgjmjjchmw.supabase.co';
ย ย ย ย const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1YXFtd25mam9wZ2ptampjaG13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1OTEyNzUsImV4cCI6MjA3NjE2NzI3NX0.9ITSBR9SNoZKgvF1AuW4OsL4b8Du5NAXttQpi7B3MO8';

ย ย ย ย // Credenciais de Admin (MANTIDAS)
ย ย ย ย const ADMIN_USER = 'admin';
ย ย ย ย const ADMIN_PASS = 'oby2025';

ย ย ย ย // --- NOVO COMPONENTE: RELATรRIO FINANCEIRO ---
ย ย ย ย function FinancialReport({ propostas }) {
ย ย ย ย ย ยย
ย ย ย ย ย ย // Filtra apenas propostas 'aprovado' para o relatรณrio de sucesso
ย ย ย ย ย ย const propostasAprovadas = propostas.filter(p => p.status === 'aprovado' && p.simulacao_economia_mensal > 0);

ย ย ย ย ย ย const formatarMoeda = (valor) => {
ย ย ย ย ย ย ย ย // Converte para float antes de formatar
ย ย ย ย ย ย ย ย const num = parseFloat(valor);ย
ย ย ย ย ย ย ย ย if (isNaN(num)) return 'R$ 0,00';
ย ย ย ย ย ย ย ย return num.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
ย ย ย ย ย ย };

ย ย ย ย ย ย const exportarParaCSV = () => {
ย ย ย ย ย ย ย ย const cabecalho = [
ย ย ย ย ย ย ย ย ย ย "Nยบ Contrato", "Vendedor", "Cliente", "Email", "Cidade",ย
ย ย ย ย ย ย ย ย ย ย "Consumo (kWh)", "Custo Atual (R$)", "Custo OBY (R$)",ย
ย ย ย ย ย ย ย ย ย ย "Desconto Aplicado (%)", "Economia Mensal (R$)", "Status"
ย ย ย ย ย ย ย ย ];

ย ย ย ย ย ย ย ย const linhas = propostasAprovadas.map(p => {
ย ย ย ย ย ย ย ย ย ย return [
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.numero_contrato || 'N/A'}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.vendedor || 'Sem Vendedor'}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.nome_completo || p.nome_fantasia || 'Sem nome'}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.email || ''}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.cidade || ''}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.consumo_kw || 0}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${formatarMoeda(p.simulacao_conta_atual).replace('R$', '').trim()}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${formatarMoeda(p.simulacao_conta_nova).replace('R$', '').trim()}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.desconto_aplicado || 0}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${formatarMoeda(p.simulacao_economia_mensal).replace('R$', '').trim()}"`,
ย ย ย ย ย ย ย ย ย ย ย ย `"${p.status}"`
ย ย ย ย ย ย ย ย ย ย ].join(';');
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย const csvContent = [cabecalho.join(';'), ...linhas].join('\n');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
ย ย ย ย ย ย ย ย const link = document.createElement("a");
ย ย ย ย ย ย ย ย const url = URL.createObjectURL(blob);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย link.setAttribute("href", url);
ย ย ย ย ย ย ย ย link.setAttribute("download", `relatorio_oby_financeiro_${new Date().toISOString().slice(0,10)}.csv`);
ย ย ย ย ย ย ย ย link.style.visibility = 'hidden';
ย ย ย ย ย ย ย ย document.body.appendChild(link);
ย ย ย ย ย ย ย ย link.click();
ย ย ย ย ย ย ย ย document.body.removeChild(link);

ย ย ย ย ย ย ย ย alert("Exportaรงรฃo iniciada! Verifique seus downloads.");
ย ย ย ย ย ย };

ย ย ย ย ย ย const totalEconomiaMensal = propostasAprovadas.reduce((sum, p) => sum + (parseFloat(p.simulacao_economia_mensal) || 0), 0);
ย ย ย ย ย ย const totalCustoAtual = propostasAprovadas.reduce((sum, p) => sum + (parseFloat(p.simulacao_conta_atual) || 0), 0);
ย ย ย ย ย ย const totalCustoNovo = propostasAprovadas.reduce((sum, p) => sum + (parseFloat(p.simulacao_conta_nova) || 0), 0);

ย ย ย ย ย ย return (
ย ย ย ย ย ย ย ย <div className="bg-white rounded-xl shadow-lg p-6">
ย ย ย ย ย ย ย ย ย ย <div className="flex justify-between items-center mb-6 border-b pb-4">
ย ย ย ย ย ย ย ย ย ย ย ย <h2 className="text-2xl font-bold text-gray-800">๐ Relatรณrio Financeiro de Propostas Aprovadas</h2>
ย ย ย ย ย ย ย ย ย ย ย ย <buttonย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย onClick={exportarParaCSV}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:opacity-50"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย disabled={propostasAprovadas.length === 0}
ย ย ย ย ย ย ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย ย ย ย ย ย ย โฌ๏ธ Exportar para CSV
ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-blue-50 p-4 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm text-gray-600">Propostas Vรกlidas</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-2xl font-bold text-blue-800">{propostasAprovadas.length}</p>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-green-50 p-4 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm text-gray-600">Total Economia Mensal</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-xl font-bold text-green-800">{formatarMoeda(totalEconomiaMensal)}</p>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-yellow-50 p-4 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm text-gray-600">Soma Custo Atual</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-xl font-bold text-yellow-800">{formatarMoeda(totalCustoAtual)}</p>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-red-50 p-4 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm text-gray-600">Soma Custo OBY</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-xl font-bold text-red-800">{formatarMoeda(totalCustoNovo)}</p>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <div className="overflow-x-auto">
ย ย ย ย ย ย ย ย ย ย ย ย <table className="min-w-full divide-y divide-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <thead className="bg-gray-50">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Nยบ Contrato</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Cliente / Vendedor</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Consumo (kWh)</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Custo Atual</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Custo OBY</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Desconto (%)</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Economia Mensal</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tbody className="bg-white divide-y divide-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {propostasAprovadas.length === 0 ? (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td colSpan="7" className="px-4 py-4 text-center text-gray-500">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Nenhuma proposta aprovada com economia calculada para o relatรณrio.
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ) : (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย propostasAprovadas.map(p => (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr key={p.id}>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm font-medium text-blue-600">{p.numero_contrato || '-'}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-gray-900">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {p.nome_completo || p.nome_fantasia || 'Sem nome'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="text-xs text-gray-500">Vendedor: {p.vendedor || 'N/A'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-right text-gray-600">{p.consumo_kw || 0} kWh</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-right text-red-600 font-semibold">{formatarMoeda(p.simulacao_conta_atual)}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-right text-green-600 font-semibold">{formatarMoeda(p.simulacao_conta_nova)}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-right text-gray-600">{p.desconto_aplicado || 0}%</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-right font-bold text-green-800">{formatarMoeda(p.simulacao_economia_mensal)}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ))
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย )}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย ย ย ย ย ย ย </table>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย );
ย ย ย ย }

ย ย ย ย // --- COMPONENTE DO MODAL (MANTIDO) ---
ย ย ย ย function EditPropostaModal({ proposta, onClose, onSave, saving }) {
ย ย ย ย ย ยย
ย ย ย ย ย ย const editableColumns = [
ย ย ย ย ย ย ย ย 'nome_completo', 'nome_fantasia', 'email', 'telefone', 'cep', 'cidade', 'estado',ย
ย ย ย ย ย ย ย ย 'cpf', 'cnpj', 'logradouro', 'numero_endereco', 'complemento', 'consumo_kw',ย
ย ย ย ย ย ย ย ย 'distribuidora_energia', 'status', 'tipo_pessoa', 'numero_instalacao',ย
ย ย ย ย ย ย ย ย 'tipo_conexao', 'modalidade_tarifaria', 'vendedor'ย
ย ย ย ย ย ย ];

ย ย ย ย ย ย const [formData, setFormData] = useState({
ย ย ย ย ย ย ย ย ...proposta,
ย ย ย ย ย ย ย ย nome_completo: proposta.nome_completo || proposta.nome_fantasia || '',
ย ย ย ย ย ย ย ย cpf: proposta.cpf || '',
ย ย ย ย ย ย ย ย cnpj: proposta.cnpj || '',
ย ย ย ย ย ย ย ย logradouro: proposta.logradouro || '',
ย ย ย ย ย ย ย ย numero_endereco: proposta.numero_endereco || '',
ย ย ย ย ย ย ย ย complemento: proposta.complemento || '',
ย ย ย ย ย ย ย ย consumo_kw: proposta.consumo_kw || 0,
ย ย ย ย ย ย ย ย distribuidora_energia: proposta.distribuidora_energia || '',
ย ย ย ย ย ย ย ย vendedor: proposta.vendedor || '' // << CAMPO VENDEDOR INSERIDO
ย ย ย ย ย ย });

ย ย ย ย ย ย const handleChange = (e) => {
ย ย ย ย ย ย ย ย const { name, value } = e.target;
ย ย ย ย ย ย ย ย setFormData(prev => ({ ...prev, [name]: value }));
ย ย ย ย ย ย };

ย ย ย ย ย ย const handleSave = () => {
ย ย ย ย ย ย ย ย const dataToSave = { id: formData.id };
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย editableColumns.forEach(column => {
ย ย ย ย ย ย ย ย ย ย if (formData.hasOwnProperty(column)) {
ย ย ย ย ย ย ย ย ย ย ย ย let value = formData[column];
ย ย ย ย ย ย ย ย ย ย ย ย if (column === 'consumo_kw') {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย value = Number(value);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย if (column === 'nome_fantasia') {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย dataToSave[column] = formData.nome_completo;
ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย dataToSave[column] = value;
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย onSave(dataToSave);
ย ย ย ย ย ย };

ย ย ย ย ย ย const inputClass = "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150";
ย ย ย ย ย ย const labelClass = "block text-sm font-medium text-gray-700 mb-1";

ย ย ย ย ย ย return (
ย ย ย ย ย ย ย ย <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
ย ย ย ย ย ย ย ย ย ย <div className="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
ย ย ย ย ย ย ย ย ย ย ย ย <div className="p-6 border-b border-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h2 className="text-2xl font-bold text-gray-800">๐ Editar Proposta: {proposta.numero_contrato || 'N/A'}</h2>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm text-gray-500">Altere os dados da proposta do cliente. O Nรบmero do Contrato nรฃo pode ser editado.</p>
ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Informaรงรตes do Contrato - Nรฃo Editรกvel */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="md:col-span-2 bg-gray-100 p-4 rounded-lg border-l-4 border-gray-400">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 className="font-bold text-lg mb-3 text-gray-700">Detalhes de Identificaรงรฃo</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="space-y-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Nรบmero do Contrato</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" value={proposta.numero_contrato || 'N/A'} disabled className={`${inputClass} bg-gray-200 cursor-not-allowed text-gray-700 font-semibold`} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Dados Pessoais (COM CAMPO VENDEDOR INSERIDO) */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 className="font-bold text-lg mb-4 text-blue-800">Dados Pessoais</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="space-y-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Nome Completo / Fantasia</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="nome_completo" value={formData.nome_completo} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Email</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="email" name="email" value={formData.email || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Telefone</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="telefone" value={formData.telefone || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>{formData.tipo_pessoa === 'fisica' ? 'CPF' : 'CNPJ'}</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <inputย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย type="text"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย name={formData.tipo_pessoa === 'fisica' ? 'cpf' : 'cnpj'}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย value={formData.tipo_pessoa === 'fisica' ? formData.cpf || '' : formData.cnpj || ''}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onChange={handleChange}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className={inputClass}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* NOVO CAMPO VENDEDOR - POSICIONADO CORRETAMENTE */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Vendedor</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="vendedor" value={formData.vendedor || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Dados de Endereรงo e Instalaรงรฃo (MANTIDOS CORRIGIDOS) */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 className="font-bold text-lg mb-4 text-green-800">Endereรงo e Instalaรงรฃo</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="space-y-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>CEP</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="cep" value={formData.cep || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Logradouro</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="logradouro" value={formData.logradouro || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="grid grid-cols-2 gap-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Nรบmero</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="numero_endereco" value={formData.numero_endereco || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Complemento</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="complemento" value={formData.complemento || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="grid grid-cols-2 gap-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Cidade</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="cidade" value={formData.cidade || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Estado (UF)</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="estado" value={formData.estado || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Distribuidora</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" name="distribuidora_energia" value={formData.distribuidora_energia || ''} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className={labelClass}>Consumo Mรฉdio (kWh)</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" step="1" name="consumo_kw" value={formData.consumo_kw || 0} onChange={handleChange} className={inputClass} />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย {/* Botรตes do Modal */}
ย ย ย ย ย ย ย ย ย ย ย ย <div className="p-6 flex justify-end gap-3 border-t border-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={onClose} className="px-6 py-3 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Cancelar
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={handleSave} disabled={saving} className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {saving ? 'Salvando...' : '๐พ Salvar Alteraรงรตes'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย );
ย ย ย ย }

ย ย ย ย // --- COMPONENTE PRINCIPAL: ADMIN PANEL ---
ย ย ย ย function AdminPanel() {
ย ย ย ย ย ย const [isAuthenticated, setIsAuthenticated] = useState(false);
ย ย ย ย ย ย const [username, setUsername] = useState('');
ย ย ย ย ย ย const [password, setPassword] = useState('');
ย ย ย ย ย ย const [propostas, setPropostas] = useState([]);
ย ย ย ย ย ย const [loading, setLoading] = useState(false);
ย ย ย ย ย ย const [selectedProposta, setSelectedProposta] = useState(null);ย
ย ย ย ย ย ย const [savingProposta, setSavingProposta] = useState(false);ย
ย ย ย ย ย ย const [filtro, setFiltro] = useState('todos');
ย ย ย ย ย ย const [busca, setBusca] = useState('');
ย ย ย ย ย ย const [activeTab, setActiveTab] = useState('propostas');
ย ย ย ย ย ย const [tarifaKwh, setTarifaKwh] = useState('0.842355');
ย ย ย ย ย ย const [proporcaoEnergia, setProporcaoEnergia] = useState('0.81');
ย ย ย ย ย ย const [proporcaoImpostos, setProporcaoImpostos] = useState('0.19');
ย ย ย ย ย ย const [descontoPercentual, setDescontoPercentual] = useState('15');ย
ย ย ย ย ย ย const [tarifaId, setTarifaId] = useState(null);
ย ย ย ย ย ย const [proporcaoEnergiaId, setProporcaoEnergiaId] = useState(null);
ย ย ย ย ย ย const [proporcaoImpostosId, setProporcaoImpostosId] = useState(null);
ย ย ย ย ย ย const [descontoId, setDescontoId] = useState(null);
ย ย ย ย ย ย const [savingConfig, setSavingConfig] = useState(false);
ย ย ย ย ย ยย
ย ย ย ย ย ย // Estados para editor de contrato
ย ย ย ย ย ย const [templates, setTemplates] = useState([]);
ย ย ย ย ย ย const [loadingTemplates, setLoadingTemplates] = useState(false);
ย ย ย ย ย ย const [savingTemplates, setSavingTemplates] = useState(false);

ย ย ย ย ย ย useEffect(() => {
ย ย ย ย ย ย ย ย const authStatus = localStorage.getItem('oby_admin_auth');
ย ย ย ย ย ย ย ย if (authStatus === 'true') {
ย ย ย ย ย ย ย ย ย ย setIsAuthenticated(true);
ย ย ย ย ย ย ย ย ย ย carregarPropostas();
ย ย ย ย ย ย ย ย ย ย carregarConfiguracoes();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }, []);

ย ย ย ย ย ย useEffect(() => {
ย ย ย ย ย ย ย ย const handleClickOutside = (event) => {
ย ย ย ย ย ย ย ย ย ย if (!event.target.closest('button')) {
ย ย ย ย ย ย ย ย ย ย ย ย setPropostas(prev => prev.map(p => ({...p, showMenu: false})));
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย document.addEventListener('click', handleClickOutside);
ย ย ย ย ย ย ย ย return () => document.removeEventListener('click', handleClickOutside);
ย ย ย ย ย ย }, []);

ย ย ย ย ย ย const handleLogin = (e) => {
ย ย ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย ย ย if (username === ADMIN_USER && password === ADMIN_PASS) {
ย ย ย ย ย ย ย ย ย ย setIsAuthenticated(true);
ย ย ย ย ย ย ย ย ย ย localStorage.setItem('oby_admin_auth', 'true');
ย ย ย ย ย ย ย ย ย ย carregarPropostas();
ย ย ย ย ย ย ย ย ย ย carregarConfiguracoes();
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย alert('Usuรกrio ou senha incorretos!');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย const handleLogout = () => {
ย ย ย ย ย ย ย ย setIsAuthenticated(false);
ย ย ย ย ย ย ย ย localStorage.removeItem('oby_admin_auth');
ย ย ย ย ย ย ย ย setUsername('');
ย ย ย ย ย ย ย ย setPassword('');
ย ย ย ย ย ย };

ย ย ย ย ย ย const carregarPropostas = async () => {
ย ย ย ย ย ย ย ย setLoading(true);
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${SUPABASE_URL}/rest/v1/propostas?select=*&order=created_at.desc`, {
ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ย ย ย setPropostas(data.map(p => ({...p, showMenu: false, updating: false})));
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('Erro ao carregar propostas:', error);
ย ย ย ย ย ย ย ย ย ย alert('Erro ao carregar propostas');
ย ย ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย ย ย setLoading(false);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย // Funรงรตes de Ediรงรฃoย
ย ย ย ย ย ย const handleEditClick = (proposta) => {
ย ย ย ย ย ย ย ย setSelectedProposta(proposta);
ย ย ย ย ย ย };

ย ย ย ย ย ย const handleSaveEdit = async (dataToSave) => {
ย ย ย ย ย ย ย ย setSavingProposta(true);
ย ย ย ย ย ย ย ย console.log('๐ Iniciando ediรงรฃo de proposta...', dataToSave);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Extrai o ID para usar no filtro e cria o payload excluindo o ID
ย ย ย ย ย ย ย ย const propostaId = dataToSave.id;
ย ย ย ย ย ย ย ย // Exclui o ID e cria o objeto de payload a ser enviado para o Supabase
ย ย ย ย ย ย ย ย const { id, ...payloadForSupabase } = dataToSave;ย
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // O filtro usa o ID (UUID)
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${SUPABASE_URL}/rest/v1/propostas?id=eq.${propostaId}`, {
ย ย ย ย ย ย ย ย ย ย ย ย method: 'PATCH',
ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Content-Type': 'application/json',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Prefer': 'return=representation'
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย // Envia o payload que nรฃo contรฉm o ID, garantindo a cirurgia no JSON
ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify(payloadForSupabase)
ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย ย ย if (response.ok) {
ย ย ย ย ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ย ย ย ย ย console.log('โ Proposta atualizada com sucesso!', data);
ย ย ย ย ย ย ย ย ย ย ย ย // Atualiza a proposta na lista
ย ย ย ย ย ย ย ย ย ย ย ย setPropostas(prev => prev.map(p =>ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย p.id === propostaId ? {...data[0], showMenu: false, updating: false} : p
ย ย ย ย ย ย ย ย ย ย ย ย ));
ย ย ย ย ย ย ย ย ย ย ย ย setSelectedProposta(null); // Fecha o modal
ย ย ย ย ย ย ย ย ย ย ย ย alert('โ Proposta atualizada com sucesso!');
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย const errorText = await response.text();
ย ย ย ย ย ย ย ย ย ย ย ย console.error('โ Erro ao salvar proposta:', errorText);
ย ย ย ย ย ย ย ย ย ย ย ย alert('โ Erro ao salvar proposta: ' + errorText);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('โ Erro ao salvar proposta:', error);
ย ย ย ย ย ย ย ย ย ย alert('Erro inesperado ao salvar proposta.');
ย ย ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย ย ย setSavingProposta(false);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };


ย ย ย ย ย ย const carregarConfiguracoes = async () => {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${SUPABASE_URL}/rest/v1/configuracoes?select=*`, {
ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (data && data.length > 0) {
ย ย ย ย ย ย ย ย ย ย ย ย data.forEach(config => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (config.chave === 'tarifa_kwh') {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setTarifaKwh(config.valor);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setTarifaId(config.id);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (config.chave === 'proporcao_energia') {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setProporcaoEnergia(config.valor);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setProporcaoEnergiaId(config.id);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (config.chave === 'proporcao_impostos') {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setProporcaoImpostos(config.valor);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setProporcaoImpostosId(config.id);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (config.chave === 'desconto_percentual') {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setDescontoPercentual(config.valor);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย setDescontoId(config.id);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('โ Erro ao carregar configuraรงรตes:', error);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย // Carregar templates do contrato
ย ย ย ย ย ย const carregarTemplates = async () => {
ย ย ย ย ย ย ย ย setLoadingTemplates(true);
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${SUPABASE_URL}/rest/v1/contrato_templates?select=*&order=ordem.asc`, {
ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ย ย ย setTemplates(data);
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('โ Erro ao carregar templates:', error);
ย ย ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย ย ย setLoadingTemplates(false);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย // Salvar templates do contrato
ย ย ย ย ย ย const salvarTemplates = async () => {
ย ย ย ย ย ย ย ย setSavingTemplates(true);
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย for (const template of templates) {
ย ย ย ย ย ย ย ย ย ย ย ย await fetch(`${SUPABASE_URL}/rest/v1/contrato_templates?id=eq.${template.id}`, {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย method: 'PATCH',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Content-Type': 'application/json',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Prefer': 'return=representation'
ย ย ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify({
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย texto: template.texto
ย ย ย ย ย ย ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย alert('โ Templates salvos com sucesso!');
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('Erro ao salvar templates:', error);
ย ย ย ย ย ย ย ย ย ย alert('Erro ao salvar templates. Tente novamente.');
ย ย ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย ย ย setSavingTemplates(false);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย const atualizarTemplate = (id, novoTexto) => {
ย ย ย ย ย ย ย ย setTemplates(templates.map(t =>ย
ย ย ย ย ย ย ย ย ย ย t.id === id ? {...t, texto: novoTexto} : t
ย ย ย ย ย ย ย ย ));
ย ย ย ย ย ย };

ย ย ย ย ย ย const salvarConfiguracoes = async () => {
ย ย ย ย ย ย ย ย setSavingConfig(true);
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Salvar ou criar desconto percentual
ย ย ย ย ย ย ย ย ย ย if (descontoId) {
ย ย ย ย ย ย ย ย ย ย ย ย await fetch(`${SUPABASE_URL}/rest/v1/configuracoes?id=eq.${descontoId}`, {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย method: 'PATCH',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify({
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย valor: String(descontoPercentual)
ย ย ย ย ย ย ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย await fetch(`${SUPABASE_URL}/rest/v1/configuracoes`, {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย method: 'POST',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify({
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย chave: 'desconto_percentual',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย valor: String(descontoPercentual),
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย descricao: 'Percentual de desconto aplicado na proposta'
ย ย ย ย ย ย ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย // ... Lรณgica similar para Tarifa e Proporรงรตes (omitida para brevidade no script)

ย ย ย ย ย ย ย ย ย ย alert(`โ Configuraรงรตes atualizadas com sucesso!\n\n` +
ย ย ย ย ย ย ย ย ย ย ย ย ย `Desconto aplicado: ${descontoPercentual}%\n` +
ย ย ย ย ย ย ย ย ย ย ย ย ย `Tarifa kWh: R$ ${tarifaKwh}\n` +
ย ย ย ย ย ย ย ย ย ย ย ย ย `Proporรงรฃo Energia: ${proporcaoEnergia}\n` +
ย ย ย ย ย ย ย ย ย ย ย ย ย `Proporรงรฃo Impostos: ${proporcaoImpostos}`);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย await carregarConfiguracoes();
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('Erro ao salvar configuraรงรตes:', error);
ย ย ย ย ย ย ย ย ย ย alert('Erro ao salvar configuraรงรตes. Tente novamente.');
ย ย ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย ย ย setSavingConfig(false);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย const atualizarStatus = async (propostaId, novoStatus) => {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย setPropostas(prev => prev.map(p =>ย
ย ย ย ย ย ย ย ย ย ย ย ย p.id === propostaId ? {...p, updating: true, showMenu: false} : {...p, showMenu: false}
ย ย ย ย ย ย ย ย ย ย ));
ย ย ย 5146 ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${SUPABASE_URL}/rest/v1/propostas?id=eq.${propostaId}`, {
ย ย ย ย ย ย ย ย ย ย ย ย method: 'PATCH',
ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${SUPABASE_KEY}`,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'apikey': SUPABASE_KEY,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Content-Type': 'application/json',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Accept': 'application/json', // ADICIONADO
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Prefer': 'return=representation'
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify({
ย ย ย ย ย ย ย ย ย ย ย ย ย ย status: novoStatusย
ย ย ย ย ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย ย ย if (response.ok) {
                        // CORREรรO FINAL: Usa headers para verificar se hรก conteรบdo antes de tentar ler o JSON.
                        const contentLength = response.headers.get('Content-Length');
                        if (contentLength && parseInt(contentLength) > 0) {
                            const data = await response.json();
                            setPropostas(prev => prev.map(p => 
                                p.id === propostaId ? {...data[0], showMenu: false, updating: false} : p
                            ));
                        } else {
                            // Se o corpo estiver vazio, recarrega todas as propostas
                            await carregarPropostas();
                        }

ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย const errorText = await response.text();
ย ย ย ย ย ย ย ย ย ย ย ย throw new Error(errorText);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('โ Erro ao atualizar status:', error);
ย ย ย ย ย ย ย ย ย ย // Corrigindo o alert para mostrar a mensagem de erro especรญfica, se possรญvel
ย ย ย ย ย ย ย ย ย ย alert(`Erro ao atualizar status: ${error.message}`); 
ย ย ย ย ย ย ย ย ย ย setPropostas(prev => prev.map(p =>ย
ย ย ย ย ย ย ย ย ย ย ย ย p.id === propostaId ? {...p, updating: false} : p
ย ย ย ย ย ย ย ย ย ย ));
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย const toggleStatusMenu = (propostaId) => {
ย ย ย ย ย ย ย ย setPropostas(prev => prev.map(p =>ย
ย ย ย ย ย ย ย ย ย ย p.id === propostaId ? {...p, showMenu: !p.showMenu} : {...p, showMenu: false}
ย ย ย ย ย ย ย ย ));
ย ย ย ย ย ย };

ย ย ย ย ย ย const formatarData = (dataISO) => {
ย ย ย ย ย ย ย ย const data = new Date(dataISO);
ย ย ย ย ย ย ย ย return data.toLocaleDateString('pt-BR');
ย ย ย ย ย ย };

ย ย ย ย ย ย const gerarContratoPDF = (proposta) => {
ย ย ย ย ย ย ย ย const { jsPDF } = window.jspdf;
ย ย ย ย ย ย ย ย const doc = new jsPDF();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย doc.setFont("helvetica");
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Nรบmero do Contrato
ย ย ย ย ย ย ย ย doc.setFontSize(10);
ย ย ย ย ย ย ย ย doc.setFont("helvetica", "normal");
ย ย ย ย ย ย ย ย doc.setTextColor(100, 100, 100);
ย ย ย ย ย ย ย ย doc.text(`Contrato Nยบ: ${proposta.numero_contrato || 'N/A'}`, 20, 15);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Tรญtulo
ย ย ย ย ย ย ย ย doc.setTextColor(0, 0, 0);
ย ย ย ย ย ย ย ย doc.setFontSize(18);
ย ย ย ย ย ย ย ย doc.setFont("helvetica", "bold");
ย ย ย ย ย ย ย ย doc.text("CONTRATO DE PRESTAรรO DE SERVIรOS", 105, 20, { align: "center" });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Conteรบdo
ย ย ย ย ย ย ย ย doc.setFontSize(11);
ย ย ย ย ย ย ย ย doc.setFont("helvetica", "normal");
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const nomeCompleto = proposta.nome_completo || proposta.nome_fantasia || 'Sem nome';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const cpfCnpj = proposta.tipo_pessoa === 'fisica' ? proposta.cpf : proposta.cnpj;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย doc.text(`CONTRATANTE: ${nomeCompleto}`, 20, 40);
ย ย ย ย ย ย ย ย doc.text(`CPF/CNPJ: ${cpfCnpj}`, 20, 50);
ย ย ย ย ย ย ย ย doc.text(`E-mail: ${proposta.email}`, 20, 60);
ย ย ย ย ย ย ย ย doc.text(`Telefone: ${proposta.telefone}`, 20, 70);
ย ย ย ย ย ย ย ย doc.text(`Endereรงo: ${proposta.logradouro}, ${proposta.numero_endereco}`, 20, 80);ย
ย ย ย ย ย ย ย ย doc.text(`${proposta.cidade} - ${proposta.estado}, CEP: ${proposta.cep}`, 20, 90);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย doc.text("CONTRATADA: OBY ENERGY", 20, 110);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Salvar
ย ย ย ย ย ย ย ย doc.save(`contrato_${nomeCompleto.replace(/\s+/g, '_')}.pdf`);
ย ย ย ย ย ย };

ย ย ย ย ย ย const getStatusBadge = (status) => {
ย ย ย ย ย ย ย ย const configs = {
ย ย ย ย ย ย ย ย ย ย 'pendente': { bg: 'bg-yellow-100', text: 'text-yellow-800', label: '๐ก Pendente' },
ย ย ย ย ย ย ย ย ย ย 'aprovado': { bg: 'bg-green-100', text: 'text-green-800', label: '๐ข Aprovado' },
ย ย ย ย ย ย ย ย ย ย 'reprovado': { bg: 'bg-red-100', text: 'text-red-800', label: '๐ด Reprovado' },
ย ย ย ย ย ย ย ย ย ย 'lista_espera': { bg: 'bg-orange-100', text: 'text-orange-800', label: '๐ Lista Espera' }
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย const config = configs[status] || configs['pendente'];
ย ย ย ย ย ย ย ย return (
ย ย ย ย ย ย ย ย ย ย <span className={`px-3 py-1 rounded-full text-xs font-semibold ${config.bg} ${config.text}`}>
ย ย ย ย ย ย ย ย ย ย ย ย {config.label}
ย ย ย ย ย ย ย ย ย ย </span>
ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย };

ย ย ย ย ย ย const propostasFiltradas = propostas.filter(proposta => {
ย ย ย ย ย ย ย ย const matchFiltro = filtro === 'todos' || proposta.status === filtro;
ย ย ย ย ย ย ย ย const matchBusca = busca === '' ||ย
ย ย ย ย ย ย ย ย ย ย proposta.nome_completo?.toLowerCase().includes(busca.toLowerCase()) ||
ย ย ย ย ย ย ย ย ย ย proposta.nome_fantasia?.toLowerCase().includes(busca.toLowerCase()) ||
ย ย ย ย ย ย ย ย ย ย proposta.email?.toLowerCase().includes(busca.toLowerCase()) ||
ย ย ย ย ย ย ย ย ย ย proposta.cidade?.toLowerCase().includes(busca.toLowerCase());
ย ย ย ย ย ย ย ย return matchFiltro && matchBusca;
ย ย ย ย ย ย });

ย ย ย ย ย ย if (!isAuthenticated) {
ย ย ย ย ย ย ย ย return (
ย ย ย ย ย ย ย ย ย ย <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4">
ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="text-center mb-8">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h1 className="text-3xl font-bold text-gray-800 mb-2">๐ Admin OBY Energy</h1>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-gray-600">Faรงa login para acessar o painel</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <form onSubmit={handleLogin} className="space-y-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className="block text-sm font-medium text-gray-700 mb-2">Usuรกrio</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <inputย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย type="text"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย value={username}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onChange={(e) => setUsername(e.target.value)}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย required
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className="block text-sm font-medium text-gray-700 mb-2">Senha</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <inputย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย type="password"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย value={password}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onChange={(e) => setPassword(e.target.value)}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย required
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <buttonย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย type="submit"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Entrar
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </form>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย }

ย ย ย ย ย ย return (
ย ย ย ย ย ย ย ย <div className="min-h-screen bg-gray-100">
ย ย ย ย ย ย ย ย ย ย <header className="bg-white shadow-md">
ย ย ย ย ย ย ย ย ย ย ย ย <div className="container mx-auto px-4 py-4 flex justify-between items-center">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h1 className="text-2xl font-bold text-blue-600">โก OBY Energy Admin</h1>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={handleLogout} className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Sair
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </header>

ย ย ย ย ย ย ย ย ย ย <div className="container mx-auto px-4 py-8">
ย ย ย ย ย ย ย ย ย ย ย ย <div className="mb-6 border-b border-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="flex space-x-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={() => setActiveTab('propostas')} className={`px-6 py-3 font-semibold transition ${activeTab === 'propostas' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐ Propostas
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={() => setActiveTab('configuracoes')} className={`px-6 py-3 font-semibold transition ${activeTab === 'configuracoes' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ๏ธ Configuraรงรตes
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={() => { setActiveTab('contrato'); carregarTemplates(); }} className={`px-6 py-3 font-semibold transition ${activeTab === 'contrato' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐ Editor de Contrato
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* NOVO BOTรO: RELATรRIO FINANCEIRO */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={() => setActiveTab('financeiro')} className={`px-6 py-3 font-semibold transition ${activeTab === 'financeiro' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-600'}`}>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐ Relatรณrio Financeiro
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย {activeTab === 'configuracoes' ? (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-white rounded-xl shadow-lg p-6 max-w-2xl">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h2 className="text-2xl font-bold mb-6 text-gray-800">โ๏ธ Configuraรงรตes do Sistema</h2>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="space-y-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-blue-50 p-6 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 className="font-bold text-lg mb-4 text-blue-800">๐ฐ Configuraรงรตes de Tarifa</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="space-y-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className="block text-sm font-medium text-gray-700 mb-2">Tarifa Total (R$/kWh)</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" step="0.000001" value={tarifaKwh} onChange={(e) => setTarifaKwh(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="grid grid-cols-2 gap-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย 5585 ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className="block text-sm font-medium text-gray-700 mb-2">Proporรงรฃo Energia</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" step="0.01" value={proporcaoEnergia} onChange={(e) => setProporcaoEnergia(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className="block text-sm font-medium text-gray-700 mb-2">Proporรงรฃo Impostos</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" step="0.01" value={proporcaoImpostos} onChange={(e) => setProporcaoImpostos(e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-green-50 p-6 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 className="font-bold text-lg mb-4 text-green-800">๐ฏ Configuraรงรฃo de Desconto</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className="block text-sm font-medium text-gray-700 mb-2">Desconto Percentual (%)</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="flex items-center gap-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <inputย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย type="number"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย step="0.1"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย min="0"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย max="100"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย value={descontoPercentual}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onChange={(e) => setDescontoPercentual(e.target.value)}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="flex-1 p-3 border border-gray-300 rounded-lg"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span className="text-2xl font-bold text-green-600">%</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-xs text-gray-600 mt-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Este percentual serรก aplicado no cรกlculo da proposta de economia
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={salvarConfiguracoes} disabled={savingConfig} className="w-full px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:opacity-50">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {savingConfig ? '๐พ Salvando...' : '๐พ Salvar Todas as Configuraรงรตes'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ) : activeTab === 'contrato' ? (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-white rounded-xl shadow-lg p-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="mb-6">
ย ย ย ย ย ย ย ย ย 5716 ย ย ย ย ย <h2 className="text-2xl font-bold text-gray-800">๐ Editor de Contrato</h2>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-gray-600 text-sm mt-2">Personalize os textos que aparecem no contrato PDF</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {loadingTemplates ? (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-center text-gray-500 py-8">Carregando templates...</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ) : templates.length === 0 ? (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 className="text-lg font-semibold text-yellow-800 mb-2">โ๏ธ Nenhum template encontrado</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-yellow-700 mb-4">A tabela <code className="bg-white px-2 py-1 rounded">contrato_templates</code> estรก vazia.</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm text-yellow-600">Para criar templates, execute o SQL no Supabase:</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <pre className="bg-white p-3 rounded mt-2 text-xs overflow-x-auto">
{`INSERT INTO contrato_templates (ordem, secao, texto) VALUES
(1, 'Introduรงรฃo', 'Contrato de prestaรงรฃo de serviรงos...'),
(2, 'Clรกusula 1', 'O objeto do presente contrato...'),
(3, 'Clรกusula 2', 'As condiรงรตes financeiras...'),
(4, 'Clรกusula 3', 'As responsabilidades...'),
(5, 'Clรกusula 4', 'Disposiรงรตes gerais...');`}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </pre>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ) : (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="space-y-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {templates.map((template, index) => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Labels descritivas para cada template (CORRIGIDO)
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const labels = {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 1: '๐ Introduรงรฃo do Contrato',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 2: '๐ Clรกusula 1 - Objeto do Contrato',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 3: '๐ฐ Clรกusula 2 - Condiรงรตes Financeiras',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 4: 'โ๏ธ Clรกusula 3 - Responsabilidades',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 5: '๐ Clรกusula 4 - Disposiรงรตes Gerais'
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const label = template.secao || labels[template.id] || labels[index + 1] || `Seรงรฃo ${index + 1}`;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย return (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div key={template.id} className="bg-gray-50 p-4 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label className="block font-semibold text-gray-700 mb-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {label}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <textarea
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย value={template.texto}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onChange={(e) => atualizarTemplate(template.id, e.target.value)}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย rows="4"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full p-3 border border-gray-300 rounded-lg font-mono text-sm"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย placeholder="Digite o texto desta seรงรฃo do contrato..."
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย })}

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="flex gap-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={salvarTemplates} disabled={savingTemplates} className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:opacity-50">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {savingTemplates ? '๐พ Salvando...' : '๐พ Salvar'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={carregarTemplates} disabled={loadingTemplates} className="flex-1 px-6 py-3 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700 disabled:opacity-50">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐ Recarregar
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-blue-50 p-4 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 className="font-semibold text-blue-800 mb-2">๐ Variรกveis Disponรญveis</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm text-gray-700">Use estas variรกveis no texto (serรฃo substituรญdas automaticamente):</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <ul className="text-sm text-gray-600 mt-2 space-y-1">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <li><code className="bg-white px-2 py-1 rounded">[NOME]</code> - Nome do cliente</li>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <li><code className="bg-white px-2 py-1 rounded">[CPF_CNPJ]</code> - CPF ou CNPJ</li>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <li><code className="bg-white px-2 py-1 rounded">[ENDERECO]</code> - Endereรงo completo</li>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <li><code className="bg-white px-2 py-1 rounded">[CIDADE]</code> - Cidade</li>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <li><code className="bg-white px-2 py-1 rounded">[ESTADO]</code> - Estado (UF)</li>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <li><code className="bg-white px-2 py-1 rounded">[DATA]</code> - Data atual</li>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <li><code className="bg-white px-2 py-1 rounded">[DESCONTO]</code> - Percentual de desconto</li>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </ul>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย )}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ) : activeTab === 'financeiro' ? (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <FinancialReport propostas={propostas} />
ย ย ย ย ย ย ย ย ย ย ย ย ) : (
ย ย ย 5853 ย ย ย ย ย ย ย ย ย ย <>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl shadow-lg p-6 text-white mb-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h2 className="text-3xl font-bold mb-2">Bem-vindo ao Painel Administrativo! ๐</h2>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-blue-100">Gerencie as propostas de energia de forma simples e eficiente</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="mt-4 flex gap-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm">Total de Propostas</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-2xl font-bold">{propostas.length}</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm">Pendentes</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-2xl font-bold">{propostas.filter(p => p.status === 'pendente').length}</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-sm">Aprovadas</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p className="text-2xl font-bold">{propostas.filter(p => p.status === 'aprovado').length}</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="bg-white rounded-xl shadow-lg p-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="mb-6 flex flex-col md:flex-row gap-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" placeholder="๐ Buscar..." value={busca} onChange={(e) => setBusca(e.target.value)} className="flex-1 p-3 border border-gray-300 rounded-lg" />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select value={filtro} onChange={(e) => setFiltro(e.target.value)} className="p-3 border border-gray-300 rounded-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="todos">Todos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="pendente">Pendente</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="aprovado">Aprovado</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="reprovado">Reprovado</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="lista_espera">Lista de Espera</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="overflow-x-auto">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <table className="w-full">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <thead className="bg-gray-50 border-b-2 border-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Nome</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Nยบ Contrato</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Email</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Cidade</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Telefone</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">CPF</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Data</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th className="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Aรงรตes</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tbody className="divide-y divide-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {propostasFiltradas.length === 0 ? (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย 5994 ย ย ย ย ย ย ย ย ย ย ย ย <td colSpan="9" className="px-4 py-8 text-center text-gray-500">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {loading ? 'Carregando...' : 'Nenhuma proposta encontrada'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ) : (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย propostasFiltradas.map((proposta) => (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr key={proposta.id} className="hover:bg-gray-50">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm font-medium text-gray-900">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {proposta.nome_completo || proposta.nome_fantasia || 'Sem nome'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm font-semibold text-blue-600">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {proposta.numero_contrato || '-'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-gray-600">{proposta.email}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-gray-600">{proposta.cidade}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-gray-600">{proposta.telefone}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-gray-600">{proposta.tipo_pessoa === 'fisica' ? proposta.cpf : proposta.cnpj}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 text-sm text-gray-600">{formatarData(proposta.created_at)}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="relative">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <buttonย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onClick={() => toggleStatusMenu(proposta.id)}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย disabled={proposta.updating}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="flex items-center gap-2 hover:opacity-80 disabled:opacity-50"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {getStatusBadge(proposta.status || 'pendente')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <svg className="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </svg>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {proposta.showMenu && (
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div className="absolute z-10 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-200 py-1 right-0">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <buttonย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onClick={() => atualizarStatus(proposta.id, 'pendente')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full text-left px-4 py-2 text-sm hover:bg-yellow-50 text-yellow-800 flex items-center gap-2"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span className="w-2 h-2 bg-yellow-500 rounded-full"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Pendente
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <buttonย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onClick={() => atualizarStatus(proposta.id, 'aprovado')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full text-left px-4 py-2 text-sm hover:bg-green-50 text-green-800 flex items-center gap-2"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span className="w-2 h-2 bg-green-500 rounded-full"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Aprovado
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <buttonย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onClick={() => atualizarStatus(proposta.id, 'reprovado')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full text-left px-4 py-2 text-sm hover:bg-red-50 text-red-800 flex items-center gap-2"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span className="w-2 h-2 bg-red-500 rounded-full"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Reprovado
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <buttonย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onClick={() => atualizarStatus(proposta.id, 'lista_espera')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย className="w-full text-left px-4 py-2 text-sm hover:bg-orange-50 text-orange-800 flex items-center gap-2"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span className="w-2 h-2 bg-orange-500 rounded-full"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Lista de Espera
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย )}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td className="px-4 py-3 flex gap-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={() => handleEditClick(proposta)} className="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐ Editar
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onClick={() => gerarContratoPDF(proposta)} className="px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐ PDF
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ))
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย )}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </table>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </>
ย ย ย ย ย ย ย ย ย ย ย ย )}
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย {selectedProposta && (
ย ย ย ย ย ย ย ย ย ย ย ย <EditPropostaModalย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย proposta={selectedProposta}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย onClose={() => setSelectedProposta(null)}ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย onSave={handleSaveEdit}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย saving={savingProposta}
ย ย ย ย ย ย ย ย ย ย ย ย />
ย ย ย ย ย ย ย ย ย ย )}
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย );
ย ย ย ย }

ย ย ย ย ReactDOM.render(<AdminPanel />, document.getElementById('root'));
ย ย </script>
</body>
</html>
