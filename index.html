<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>OBY Energy Admin - Parte 2</title>
</head>
<body>
    <script type="text/babel">
        // CONTINUA√á√ÉO DO C√ìDIGO DA PARTE 1

        // --- COMPONENTE DO MODAL DE EDI√á√ÉO ---
        function EditPropostaModal({ proposta, onClose, onSave, saving }) {
            
            const editableColumns = [
        
        'nome', 'sobrenome', 'nome_fantasia', 'email', 'telefone', 'cep', 'cidade', 'estado', 
                'cpf', 'cnpj', 'logradouro', 'numero_endereco', 'complemento', 'consumo_kwh', 
                'distribuidora_energia', 'status', 'tipo_pessoa', 'numero_instalacao', 
                'tipo_conexao', 'vendedor' 
            ];
const [formData, setFormData] = useState({
                ...proposta,
                nome: proposta.nome || '',
                sobrenome: proposta.sobrenome || '',
                cpf: proposta.cpf || '',
                cnpj: proposta.cnpj || '',
    
            logradouro: proposta.logradouro || '',
                numero_endereco: proposta.numero_endereco || '',
                complemento: proposta.complemento || '',
                consumo_kwh: proposta.consumo_kwh || 0,
                distribuidora_energia: proposta.distribuidora_energia || '',
         
       vendedor: proposta.vendedor || ''
            });
const handleChange = (e) => {
                const { name, value } = e.target;
setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSave = () => {
                const dataToSave = { id: formData.id };
if (!formData.numero_contrato || formData.numero_contrato === '-') {
                    const anoAtual = new Date().getFullYear();
const idCurto = String(formData.id).slice(-5);
                    dataToSave.numero_contrato = `OBY-${anoAtual}-${idCurto}`;
                }
                
                editableColumns.forEach(column => {
                    if (formData.hasOwnProperty(column)) {
                        let value = formData[column];
          
              if (column === 'consumo_kwh') {
                            value = Number(value);
                        }
                        dataToSave[column] = value;
  
                  }
                });
onSave(dataToSave);
            };

            const inputClass = "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150";
const labelClass = "block text-sm font-medium text-gray-700 mb-1";

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
                        <div className="p-6 border-b border-gray-200">
           
                 <h2 className="text-2xl font-bold text-gray-800">üìù Editar Proposta: {proposta.numero_contrato || 'N/A'}</h2>
                            <p className="text-sm text-gray-500">Altere os dados da proposta do cliente. O N√∫mero do Contrato n√£o pode ser editado.</p>
                        </div>

       
                 <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto">
                            {/* Informa√ß√µes do Contrato */}
                            <div className="md:col-span-2 bg-gray-100 p-4 rounded-lg border-l-4 border-gray-400">
           
                     <h3 className="font-bold text-lg mb-3 text-gray-700">Detalhes de Identifica√ß√£o</h3>
                                <div className="space-y-3">
                                    <div>
    
                                    <label className={labelClass}>N√∫mero do Contrato</label>
                                        <input type="text" value={proposta.numero_contrato ||
'N/A'} disabled className={`${inputClass} bg-gray-200 cursor-not-allowed text-gray-700 font-semibold`} />
                                    </div>
                                </div>
                         
   </div>

                            {/* Dados Pessoais */}
                            <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400">
                                <h3 
className="font-bold text-lg mb-4 text-blue-800">Dados Pessoais</h3>
                                <div className="space-y-4">
                                    <div>
                           
             <label className={labelClass}>Nome</label>
                                        <input type="text" name="nome" value={formData.nome} onChange={handleChange} className={inputClass} />
                                    </div>
    
                                <div>
                                        <label className={labelClass}>Sobrenome</label>
                           
             <input type="text" name="sobrenome" value={formData.sobrenome} onChange={handleChange} className={inputClass} />
                                    </div>
                                    {formData.tipo_pessoa === 'juridica' && (
     
                                   <div>
                                            <label className={labelClass}>Nome Fantasia</label>
                   
                         <input type="text" name="nome_fantasia" value={formData.nome_fantasia ||
''} onChange={handleChange} className={inputClass} />
                                        </div>
                                    )}
                     
               <div>
                                        <label className={labelClass}>Email</label>
                                        <input type="email" name="email" value={formData.email 
|| ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                        
                <label className={labelClass}>Telefone</label>
                                        <input type="text" name="telefone" value={formData.telefone ||
''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                         
               <label className={labelClass}>{formData.tipo_pessoa === 'fisica' ?
'CPF' : 'CNPJ'}</label>
                                        <input 
                                            type="text" 
            
                                name={formData.tipo_pessoa === 'fisica' ?
'cpf' : 'cnpj'} 
                                            value={formData.tipo_pessoa === 'fisica' ?
formData.cpf || '' : formData.cnpj || ''} 
                                            onChange={handleChange} 
                                            className={inputClass} 
   
                                     />
                                    </div>
                           
         <div>
                                        <label className={labelClass}>Vendedor</label>
                                        <input type="text" name="vendedor" value={formData.vendedor ||
''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                         
               <label className={labelClass}>Status da Proposta</label>
                                        <select name="status" value={formData.status ||
'pendente'} onChange={handleChange} className={inputClass}>
                                            <option value="pendente">üü° Pendente</option>
                                            <option value="aprovado">üü¢ Aprovado</option>
      
                                      <option value="reprovado">üî¥ Reprovado</option>
                                            <option value="lista_espera">üü† Lista de Espera</option>
            
                            </select>
                                    </div>
                                </div>
    
                        </div>

                            {/* Dados de Endere√ßo e Instala√ß√£o */}
                            <div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
         
                       <h3 className="font-bold text-lg mb-4 text-green-800">Endere√ßo e Instala√ß√£o</h3>
                                <div className="space-y-4">
                                    <div>
  
                                      <label className={labelClass}>CEP</label>
                                        <input type="text" name="cep" value={formData.cep ||
''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                         
               <label className={labelClass}>Logradouro</label>
                                        <input type="text" name="logradouro" value={formData.logradouro ||
''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                      
                  <div>
                                            <label className={labelClass}>N√∫mero</label>
                                     
       <input type="text" name="numero_endereco" value={formData.numero_endereco ||
''} onChange={handleChange} className={inputClass} />
                                        </div>
                                        <div>
                 
                           <label className={labelClass}>Complemento</label>
                                            <input type="text" name="complemento" value={formData.complemento ||
''} onChange={handleChange} className={inputClass} />
                                        </div>
                                    </div>
                     
               <div className="grid grid-cols-2 gap-4">
                                        <div>
                                          
  <label className={labelClass}>Cidade</label>
                                            <input type="text" name="cidade" value={formData.cidade ||
''} onChange={handleChange} className={inputClass} />
                                        </div>
                                        <div>
                 
                           <label className={labelClass}>Estado (UF)</label>
                                            <input type="text" name="estado" value={formData.estado ||
''} onChange={handleChange} className={inputClass} />
                                        </div>
                                    </div>
                     
               <div>
                                        <label className={labelClass}>Distribuidora</label>
                                        <input type="text" name="distribuidora_energia" value={formData.distribuidora_energia 
|| ''} onChange={handleChange} className={inputClass} />
                                    </div>
                                    <div>
                        
                <label className={labelClass}>Consumo M√©dio (kWh)</label>
                                        <input type="number" step="1" name="consumo_kwh" value={formData.consumo_kwh ||
0} onChange={handleChange} className={inputClass} />
                                    </div>
                                </div>
                            </div>
 
                       </div>
                        
                        {/* Bot√µes do Modal */}
                        <div 
className="p-6 flex justify-end gap-3 border-t border-gray-200">
                            <button onClick={onClose} className="px-6 py-3 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600">
                                Cancelar
                           
 </button>
                            <button onClick={handleSave} disabled={saving} className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50">
                                {saving ?
'Salvando...' : 'üíæ Salvar Altera√ß√µes'}
                            </button>
                        </div>
                    </div>
                </div>
        
    );
        }

        // --- NOVO COMPONENTE DO VISUALIZADOR DE CONTRATO (ContratoViewerModal) ---
        function ContratoViewerModal({ proposta, onClose }) {
            if (!proposta) return null;

            // Fun√ß√£o auxiliar para obter o nome/documento correto
            const getNomeContratante = () => {
                if (proposta.tipo_pessoa === 'juridica') {
                    return proposta.nome_fantasia || `${proposta.nome} ${proposta.sobrenome}`;
                }
                return `${proposta.nome} ${proposta.sobrenome}`;
            };

            const getDocumentoContratante = () => {
                return proposta.tipo_pessoa === 'fisica' ? proposta.cpf : proposta.cnpj;
            };

            const getEnderecoCompleto = () => {
                const numero = proposta.numero_endereco ? `, ${proposta.numero_endereco}` : '';
                const complemento = proposta.complemento ? ` - ${proposta.complemento}` : '';
                const cidadeEstado = (proposta.cidade && proposta.estado) ? `${proposta.cidade}/${proposta.estado}` : '';
                const cep = proposta.cep ? ` - CEP: ${proposta.cep}` : '';

                return `${proposta.logradouro}${numero}${complemento}, ${cidadeEstado}${cep}`;
            };
            
            // Fun√ß√£o auxiliar para formatar n√∫meros para exibi√ß√£o
            const formatNumber = (num) => {
                // Certifica-se de que √© um n√∫mero e usa fallback
                const numberValue = Number(num) || 0;
                return numberValue.toLocaleString('pt-BR');
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[95vh] flex flex-col">
                        <div className="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h2 className="text-2xl font-bold text-gray-800">üìÑ Contrato: {proposta.numero_contrato || 'N/A'}</h2>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-3xl leading-none">
                                &times;
                            </button>
                        </div>

                        {/* Corpo do Contrato */}
                        <div className="p-8 overflow-y-auto leading-relaxed text-gray-800 print:p-0">
                            
                            <div className="max-w-3xl mx-auto space-y-6">
                                <h1 className="text-center text-xl font-bold uppercase mb-8">CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS DE ENERGIA</h1>
                                
                                {/* Cabe√ßalho do Contrato (Baseado na imagem do Editor de Contrato) */}
                                <div className="border p-4 rounded-lg bg-gray-50">
                                    <h3 className="font-bold mb-2">Cabe√ßalho do Contrato</h3>
                                    <p className="text-sm">
                                        Este contrato √© celebrado entre:
                                    </p>
                                    <p className="font-semibold mt-2">
                                        CONTRATANTE: **{getNomeContratante()}**
                                    </p>
                                    <p className="text-sm">
                                        CPF/CNPJ: **{getDocumentoContratante()}**
                                    </p>
                                    <p className="text-sm">
                                        Endere√ßo: **{getEnderecoCompleto()}**
                                    </p>
                                </div>

                                {/* Objeto do Contrato (Baseado na imagem do Editor de Contrato) */}
                                <div>
                                    <h3 className="font-bold text-lg mt-6 mb-3">Objeto do Contrato</h3>
                                    
                                    <p className="text-sm font-bold uppercase">
                                        CL√ÅUSULA 1¬™ - OBJETO
                                    </p>
                                    <p className="text-sm mt-1">
                                        O presente contrato tem por objeto a presta√ß√£o de servi√ßos de fornecimento de energia el√©trica atrav√©s do mercado livre de energia, com **desconto sobre a tarifa convencional** aplicada pela distribuidora local.
                                    </p>

                                    <p className="text-sm mt-4">
                                        1.1 - A CONTRATADA compromete-se a fornecer energia el√©trica com **desconto de [X]%** sobre o valor da tarifa convencional.
                                    </p>
                                    
                                    {/* Dados da Proposta no Contrato */}
                                    <p className="text-sm mt-4">
                                        1.2 - O fornecimento ser√° realizado na unidade consumidora n√∫mero **{proposta.numero_instalacao || '[N√∫mero da Instala√ß√£o]'}** localizada no endere√ßo mencionado acima.
                                    </p>
                                    <p className="text-sm mt-2">
                                        1.3 - O Consumo M√©dio mensal estimado da unidade √© de aproximadamente **{formatNumber(proposta.consumo_kwh || 0)} kWh**.
                                    </p>
                                    <p className="text-sm mt-2">
                                        1.4 - A Distribuidora de Energia local √© a **{proposta.distribuidora_energia || '[Distribuidora]'}**.
                                    </p>
                                    <p className="text-sm mt-2">
                                        1.5 - Este contrato √© referente a uma proposta criada em **{new Date(proposta.data).toLocaleDateString('pt-BR')}**.
                                    </p>
                                    
                                    {/* Placeholder para o restante do contrato */}
                                    <p className="text-sm mt-6 text-center font-bold italic text-gray-400">
                                        [Espa√ßo para o restante das cl√°usulas do contrato: vig√™ncia, pagamento, rescis√£o, etc., conforme o template completo.]
                                    </p>
                                </div>

                                {/* Rodap√© - Dados de Refer√™ncia */}
                                <div className="mt-10 pt-4 border-t border-gray-200 text-xs text-gray-500">
                                    <p>Vendedor Respons√°vel: **{proposta.vendedor || '[Vendedor N√£o Informado]'}**</p>
                                    <p>Contrato OBY ID: {proposta.numero_contrato || 'N/A'}</p>
                                </div>
                            </div>
                        </div>

                        {/* Bot√µes do Modal de Visualiza√ß√£o */}
                        <div className="p-4 border-t border-gray-200 flex justify-end">
                            <button onClick={onClose} className="px-6 py-3 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600">
                                Fechar
                            </button>
                            {/* Um bot√£o de Imprimir aproveita a funcionalidade nativa do navegador */}
                            <button onClick={() => window.print()} className="ml-3 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700">
                                üñ®Ô∏è Imprimir
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- IN√çCIO DA FUN√á√ÉO DO PAINEL PRINCIPAL (AdminPanel) ---

        // Simula√ß√£o do componente principal que gerencia o estado e renderiza o grid
        function AdminPanel() {
            // Requer o hook useState do React
            const [propostaParaContrato, setPropostaParaContrato] = React.useState(null);
            const [modalEdicaoAberta, setModalEdicaoAberta] = React.useState(null);
            
            // Simula√ß√£o de dados (dados reais viriam de uma API/Estado)
            const [propostas, setPropostas] = React.useState([
                { id: 1, numero_contrato: 'OBY-2025-195ae', nome: 'Humberto', sobrenome: 'Campos', email: 'humberto@hai.expert', cidade: 'Curitiba', telefone: '41996247863', cpf: '029.312.859-60', tipo_pessoa: 'fisica', vendedor: 'Jo√£o Silva Santos', data: '2025-01-11', status: 'pendente', logradouro: 'Rua das Flores', numero_endereco: '100', complemento: 'Apto 101', cep: '80000-000', estado: 'PR', consumo_kwh: 500, distribuidora_energia: 'Copel', numero_instalacao: '123456789' },
                { id: 2, numero_contrato: 'OBY-2025-c7b72', nome: 'Kely', sobrenome: 'Zamperoni', email: 'kely.oliveira@obyenergy.com', cidade: 'Pinhais', telefone: '41996445732', cpf: '033.571.329-74', tipo_pessoa: 'fisica', vendedor: 'Jo√£o Silva Santos', data: '2025-10-31', status: 'lista_espera', logradouro: 'Rua das Oliveiras', numero_endereco: '50', complemento: 'Casa 2', cep: '83000-000', estado: 'PR', consumo_kwh: 1200, distribuidora_energia: 'Neoenergia', numero_instalacao: '987654321' },
                // ... mais propostas (simula√ß√£o de dados da tabela)
            ]);

            // Fun√ß√µes de manipula√ß√£o do NOVO MODAL
            const handleVerContrato = (proposta) => {
                setPropostaParaContrato(proposta);
            };

            const handleFecharContrato = () => {
                setPropostaParaContrato(null);
            };

            // Fun√ß√µes de manipula√ß√£o do MODAL DE EDI√á√ÉO (existente)
            const handleOpenEdit = (proposta) => {
                setModalEdicaoAberta(proposta);
            };

            const handleCloseEdit = () => {
                setModalEdicaoAberta(null);
            };
            
            // Simula√ß√£o da fun√ß√£o onSave (para evitar erros)
            const handleSave = (dataToSave) => {
                // L√≥gica real de salvar no backend e atualizar a lista
                console.log("Salvando dados:", dataToSave);
                setModalEdicaoAberta(null);
                // Atualizar a lista (simulado)
                setPropostas(prev => prev.map(p => p.id === dataToSave.id ? { ...p, ...dataToSave } : p));
            };


            return (
                <div className="min-h-screen bg-gray-100 font-sans">
                    <header className="bg-white shadow-md p-4 flex justify-between items-center">
                        <h1 className="text-2xl font-bold text-gray-800">‚ö° OBY Energy Admin</h1>
                        <button className="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600">Sair</button>
                    </header>

                    <nav className="bg-white shadow-md mt-1 p-3 flex border-b border-gray-200">
                        {/* Simula√ß√£o das abas */}
                        {['Propostas', 'Configura√ß√µes', 'Editor de Contrato', 'Relat√≥rio Financeiro', 'Vendedores'].map(tab => (
                            <button key={tab} className={`px-4 py-2 text-sm font-medium ${tab === 'Propostas' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-blue-500'}`}>
                                {tab}
                            </button>
                        ))}
                    </nav>

                    <main className="p-6">
                        <h2 className="text-2xl font-semibold mb-6">Lista de Propostas</h2>
                        
                        {/* Simula√ß√£o do Grid de Propostas (Baseado na image_5f96e0.png) */}
                        <div className="bg-white shadow-xl rounded-lg overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        {['NOME', 'N¬∫ CONTRATO', 'EMAIL', 'CIDADE', 'TELEFONE', 'CPF', 'VENDEDOR', 'DATA', 'STATUS', 'A√á√ïES'].map(header => (
                                            <th key={header} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{header}</th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {propostas.map((prop) => (
                                        <tr key={prop.id} className="hover:bg-yellow-50/50">
                                            <td className="px-6 py-4 whitespace-nowrap">{prop.nome} {prop.sobrenome}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-blue-600 font-medium">{prop.numero_contrato}</td>
                                            <td className="px-6 py-4 whitespace-nowrap">{prop.email}</td>
                                            <td className="px-6 py-4 whitespace-nowrap">{prop.cidade}</td>
                                            <td className="px-6 py-4 whitespace-nowrap">{prop.telefone}</td>
                                            <td className="px-6 py-4 whitespace-nowrap">{prop.cpf}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-green-600 font-bold">{prop.vendedor}</td>
                                            <td className="px-6 py-4 whitespace-nowrap">{new Date(prop.data).toLocaleDateString('pt-BR')}</td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${prop.status === 'pendente' ? 'bg-yellow-100 text-yellow-800' : prop.status === 'aprovado' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                    {prop.status === 'pendente' ? 'üü° Pendente' : prop.status === 'lista_espera' ? 'üü† Lista Espera' : prop.status}
                                                </span>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button className="bg-purple-600 text-white py-2 px-3 rounded-lg text-xs font-bold hover:bg-purple-700">Anexos</button>
                                                <button onClick={() => handleOpenEdit(prop)} className="bg-blue-600 text-white py-2 px-3 rounded-lg text-xs font-bold hover:bg-blue-700 ml-2">Editar</button>
                                                {/* O BOT√ÉO PDF AGORA ABRE O MODAL DE VISUALIZA√á√ÉO */}
                                                <button 
                                                    onClick={() => handleVerContrato(prop)} 
                                                    className="bg-green-600 text-white py-2 px-3 rounded-lg text-xs font-bold hover:bg-green-700 ml-2"
                                                >
                                                    PDF
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </main>

                    {/* MODAIS */}

                    {/* 1. Modal de Edi√ß√£o (original do c√≥digo) */}
                    {modalEdicaoAberta && (
                        <EditPropostaModal 
                            proposta={modalEdicaoAberta} 
                            onClose={handleCloseEdit} 
                            onSave={handleSave}
                            saving={false} // Simula√ß√£o do estado de salvamento
                        />
                    )}

                    {/* 2. Novo Modal de Visualiza√ß√£o de Contrato */}
                    {propostaParaContrato && (
                        <ContratoViewerModal 
                            proposta={propostaParaContrato} 
                            onClose={handleFecharContrato} 
                        />
                    )}

                </div>
            );
        }

        // Renderiza√ß√£o (Comentada, pois depende do ambiente React/Babel)
        // ReactDOM.render(<AdminPanel />, document.getElementById('root'));
        
    </script>
</body>
</html>